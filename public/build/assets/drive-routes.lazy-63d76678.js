import{Q as bn,i as Cs,h as wn,k as Sn,l as In,q as C,m as Z,n as I,p as xe,j as s,P as kn,o as E,T as c,t as M,v as N,w as x,W as Q,x as ke,y as Pe,z as K,D as X,A as te,B as V,C as Ee,E as De,G as ge,H as D,I as L,J as H,K as _,L as Ne,M as ve,O as G,S as Y,V as O,X as rs,r as h,Y as W,Z as Gs,_ as Zs,$ as le,a0 as T,a1 as Xs,a2 as je,a3 as ce,a4 as as,a5 as de,a6 as q,u as Fe,a7 as is,a8 as Pn,a9 as Js,aa as En,ab as Dn,ac as os,ad as we,ae as et,af as st,ag as Nn,ah as ls,c as As,ai as Fn,aj as qe,ak as tt,al as nt,am as es,an as se,ao as rt,ap as Ts,aq as Ls,ar as Mn,as as Cn,at as ss,au as ye,av as We,aw as An,ax as Tn,ay as Ln,az as _e,aA as cs,aB as at,aC as it,aD as Rn,aE as ds,aF as zn,aG as $e,aH as ot,aI as lt,R as qn,aJ as _n,aK as ze,aL as us,aM as Rs,aN as oe,aO as Qe,aP as Ve,aQ as Me,aR as Ce,aS as $n,aT as On,aU as Kn,aV as ms,aW as He,aX as Ye,aY as ct,aZ as ts,a_ as Bn,a$ as Un,b0 as Wn,b1 as Qn,b2 as Vn,b3 as fs,b4 as Hn,b5 as Yn,b6 as Gn,b7 as zs,b8 as dt,b9 as Zn,ba as ut,bb as Xn,bc as mt,bd as ft,N as Jn,be as er,bf as sr,bg as ht,bh as tr,bi as nr}from"./main-685e91d2.js";import{S as rr,G as ar,P as xt,A as ir,B as or,F as Oe,a as pt,U as lr,D as gt,C as hs,R as cr,b as dr,c as ur,d as mr,e as fr,f as hr,g as xr,h as pr,i as gr,j as qs,k as vr,V as jr,l as yr,I as br,m as wr}from"./GridView-f1501bdc.js";import{A as xs,D as ps,u as Ge,a as vt,d as jt,b as Sr,c as _s,L as Ir,e as yt,F as Ke,f as Be,g as gs,M as vs,h as ue,i as kr,j as bt,k as Pr,l as $s,I as Er,m as wt,n as St,o as Os,p as It,q as kt,r as Dr}from"./dashboard-layout-5c157303.js";import{S as Nr,B as js,a as Ie,C as Fr}from"./breadcrumb-a182ef5c.js";import{A as Mr}from"./ArrowBack-f0ee00c6.js";var Cr=class extends bn{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e,t){super.setOptions({...e,behavior:Cs()},t)}getOptimisticResult(e){return e.behavior=Cs(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var l,u,f,m;const{state:n}=e,r=super.createResult(e,t),{isFetching:a,isRefetching:i}=r,o=a&&((u=(l=n.fetchMeta)==null?void 0:l.fetchMore)==null?void 0:u.direction)==="forward",d=a&&((m=(f=n.fetchMeta)==null?void 0:f.fetchMore)==null?void 0:m.direction)==="backward";return{...r,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:wn(t,n.data),hasPreviousPage:Sn(t,n.data),isFetchingNextPage:o,isFetchingPreviousPage:d,isRefetching:i&&!o&&!d}}};function ys(e,t){return In(e,Cr,t)}const A={fetchEntries:e=>{const t=["drive-entries"];if((e==null?void 0:e.userId)!=null&&(t.push("user"),t.push(e.userId)),e){const{userId:n,workspaceId:r,...a}=e;t.push(a)}return t},fetchUserFolders(e){const t=["user-folders"];return e&&t.push(e),t},fetchShareableLink:e=>{const t=["shareable-link"];return e&&t.push(e),t},fetchFolderPath(e,t){const n=["folder-path"];return e&&n.push(e),t&&n.push(t),n},fetchEntryShareableLink:e=>["file-entries",e,"shareable-link"],fetchFileEntry:e=>{const t=["drive/file-entries/model"];return e&&t.push(e),t},fetchStorageSummary:["storage-summary"]};function B(){return Promise.all([C.invalidateQueries({queryKey:A.fetchEntries()}),C.invalidateQueries({queryKey:A.fetchFolderPath()}),C.invalidateQueries({queryKey:A.fetchUserFolders()}),C.invalidateQueries({queryKey:A.fetchFileEntry()})])}function Pt(){return Z({queryKey:A.fetchStorageSummary,queryFn:Ar,select:Tr})}function Ar(){return I.get("user/space-usage").then(e=>e.data)}function Tr(e){const t=e.available===null?0:e.used*100/e.available;return{usedFormatted:xe(e.used,2),availableFormatted:xe(e.available,0),percentage:t,used:e.used,available:e.available}}function Lr(e){return s.jsx(kn,{...e,role:"meter progressbar"})}function Rr(){const{isLoading:e,data:t}=Pt(),n=s.jsx("span",{className:E("whitespace-nowrap",e&&"invisible"),children:s.jsx(c,{message:":used of :available used",values:{used:t==null?void 0:t.usedFormatted,available:t==null?void 0:t.availableFormatted}})});return s.jsxs("div",{className:"mt-24 flex items-start gap-16 border-t pl-24 pt-24",children:[s.jsx(rr,{className:"-mt-4 icon-md"}),s.jsx(Lr,{className:"max-w-144 flex-auto",size:"xs",value:t==null?void 0:t.percentage,label:n,showValueLabel:!1,labelPosition:"bottom"})]})}function zr(e){return M({mutationFn:t=>qr(t),onSuccess:()=>{N(x("Created workspace")),C.invalidateQueries({queryKey:Q.fetchUserWorkspaces})},onError:t=>ke(t,e)})}function qr(e){return I.post("workspace",e).then(t=>t.data)}function _r(){const e=Pe(),{formId:t,close:n}=K(),r=zr(e);return s.jsxs(X,{children:[s.jsx(te,{children:s.jsx(c,{message:"Create workspace"})}),s.jsx(V,{children:s.jsx(Ee,{form:e,id:t,onSubmit:()=>{r.mutate(e.getValues(),{onSuccess:a=>{n(a.workspace.id)}})},children:s.jsx(De,{name:"name",autoFocus:!0,label:s.jsx(c,{message:"Workspace name"}),minLength:3,required:!0})})}),s.jsxs(ge,{children:[s.jsx(D,{variant:"text",onClick:n,children:s.jsx(c,{message:"Cancel"})}),s.jsx(D,{variant:"flat",color:"primary",type:"submit",form:t,disabled:r.isPending,children:s.jsx(c,{message:"Create"})})]})]})}function $r(e){return I.get(`workspace/${e}`).then(t=>t.data)}function Or(e){return Z({queryKey:Q.workspaceWithMembers(e),queryFn:()=>$r(e)})}function Kr({workspaceId:e,...t}){return I.post(`workspace/${e}/invite`,t).then(n=>n.data)}function Br(){return M({mutationFn:e=>Kr(e),onSuccess:(e,t)=>{C.invalidateQueries({queryKey:Q.workspaceWithMembers(t.workspaceId)})},onError:e=>L(e)})}function Ur({workspaceId:e,inviteId:t,...n}){return I.post(`workspace/${e}/${t}/resend`,n).then(r=>r.data)}function Wr(){return M({mutationFn:e=>Ur(e),onSuccess:()=>{N("Invite sent")},onError:e=>L(e)})}function Qr({workspaceId:e,member:t,...n}){const r=t.model_type,a=t.model_type==="invite"?t.id:t.member_id;return I.post(`workspace/${e}/${r}/${a}/change-role`,n).then(i=>i.data)}function Vr(){return M({mutationFn:e=>Qr(e),onSuccess:(e,t)=>{N(x("Role changed")),C.invalidateQueries({queryKey:Q.workspaceWithMembers(t.workspaceId)})},onError:e=>L(e)})}function Hr({workspaceId:e,memberId:t,memberType:n}){const r=n==="invite"?`workspace/invite/${t}`:`workspace/${e}/member/${t}`;return I.delete(r).then(a=>a.data)}function Et(){const{workspaceId:e,setWorkspaceId:t}=H(),{user:n}=_();return M({mutationFn:r=>Hr(r),onSuccess:(r,a)=>{C.invalidateQueries({queryKey:Q.fetchUserWorkspaces}),C.invalidateQueries({queryKey:Q.workspaceWithMembers(a.workspaceId)}),a.memberId===(n==null?void 0:n.id)&&e===a.workspaceId&&t(Ne.id)},onError:r=>L(r)})}function Dt({onConfirm:e,isLoading:t}){return s.jsx(ve,{isDanger:!0,title:s.jsx(c,{message:"Leave workspace"}),isLoading:t,onConfirm:e,body:s.jsxs("div",{children:[s.jsx(c,{message:"Are you sure you want to leave this workspace?"}),s.jsx("div",{className:"mt-8 font-semibold",children:s.jsx(c,{message:"All resources you've created in the workspace will be transferred to workspace owner."})})]}),confirm:s.jsx(c,{message:"Leave"})})}const Yr=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function Nt(e){return!e||e.length>320?!1:Yr.test(e)}function Gr({workspace:e}){const{data:t,isLoading:n}=Or(e.id);return s.jsxs(X,{size:"lg",children:[s.jsx(te,{children:s.jsx(c,{message:"Manage workspace members"})}),s.jsx(V,{children:n?s.jsx("div",{className:"flex min-h-[238px] items-center justify-center",children:s.jsx(G,{isIndeterminate:!0,"aria-label":"Loading workspace..."})}):s.jsx(Zr,{workspace:t.workspace})})]})}function Zr({workspace:e}){const{user:t}=_(),n=bs(e),r=[...e.members||[],...e.invites||[]],a=!n.update&&!n.delete;return s.jsxs("div",{children:[n.invite&&s.jsx(ea,{workspace:e}),s.jsxs("div",{className:"mb-14 flex items-center gap-10 text-base",children:[s.jsx(ar,{className:"icon-sm"}),s.jsx(c,{message:"Members of `:workspace`",values:{workspace:e.name}})]}),s.jsxs(Y,{initial:!1,children:[r.map(i=>a&&i.id!==(t==null?void 0:t.id)?null:s.jsx(Xr,{workspace:e,member:i},`${i.model_type}.${i.id}`)),a&&s.jsx("div",{className:"text-muted",children:s.jsx(c,{message:"And [one one other member|:count other members]",values:{count:r.length}})})]})]})}function Xr({workspace:e,member:t}){return s.jsxs(O.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"mb-20 flex items-start gap-14 text-sm",children:[s.jsx(rs,{className:"flex-shrink-0",size:"lg",circle:!0,label:t.name,src:t.image,fallback:"initials"}),s.jsxs("div",{className:"min-w-0 flex-auto items-center justify-between gap-14 md:flex",children:[s.jsxs("div",{className:"mb-10 overflow-hidden md:mb-0 md:mr-10",children:[s.jsxs("div",{className:"flex items-center justify-start gap-6",children:[s.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:t.name}),s.jsx(na,{workspace:e,member:t})]}),s.jsx("div",{className:"text-muted",children:t.email})]}),s.jsx(Jr,{workspace:e,member:t})]})]},`${t.model_type}.${t.id}`)}function bs(e){var i;const{user:t}=_(),n={update:!1,invite:!1,delete:!1},r=["update","invite","delete"],a=(i=e.members)==null?void 0:i.find(o=>o.id===(t==null?void 0:t.id));return a&&r.forEach(o=>{var d;n[o]=a.is_owner||!!((d=a.permissions)!=null&&d.find(l=>l.name===`workspace_members.${o}`))}),n}function Jr({workspace:e,member:t}){const[n,r]=h.useState(t.role_id),a=Vr(),{user:i}=_(),o=bs(e),d=t.model_type==="member"&&t.is_owner,l=t.model_type==="member"&&(i==null?void 0:i.id)===t.id,u=!o.update||d||l?s.jsx("div",{className:"ml-auto text-muted first:capitalize",children:s.jsx(c,{message:t.role_name})}):s.jsx(Ft,{className:"ml-auto flex-shrink-0",size:"xs",value:n,isDisabled:a.isPending,onChange:f=>{r(f),a.mutate({roleId:f,workspaceId:e.id,member:t})}});return s.jsxs(s.Fragment,{children:[u,!d&&(l||o.delete)&&s.jsx(sa,{type:l?"leave":"remove",member:t,workspace:e})]})}function ea({workspace:e}){const{trans:t}=W(),[n,r]=h.useState([]),a=n.every(f=>!f.invalid),i=f=>f.description||f.name,[o,d]=h.useState(),l=Br(),{data:u}=Gs(["workspaceRoles"]);return h.useEffect(()=>{var f;!o&&((f=u==null?void 0:u.workspaceRoles)!=null&&f.length)&&d(u.workspaceRoles[0].id)},[u,o]),s.jsxs("div",{className:"mb-30",children:[s.jsx(Zs,{value:n,onChange:r,displayWith:i,validateWith:f=>{const m=!Nt(f.description);return{...f,invalid:m,errorMessage:m?t({message:"Not a valid email"}):void 0}},placeholder:t({message:"Enter email addresses"}),label:s.jsx(c,{message:"Invite people"})}),s.jsxs("div",{className:"mt-14 flex items-center justify-between gap-14",children:[s.jsx(Ft,{onChange:d,value:o}),n.length&&o?s.jsx(D,{variant:"flat",color:"primary",size:"sm",disabled:l.isPending||!a,onClick:()=>{l.mutate({emails:n.map(f=>i(f)),roleId:o,workspaceId:e.id},{onSuccess:()=>{r([])}})},children:s.jsx(c,{message:"Invite"})}):null]})]})}function sa({member:e,workspace:t,type:n}){const r=Et(),{close:a}=K();return s.jsxs(le,{type:"modal",onClose:i=>{i&&(r.mutate({workspaceId:t.id,memberId:e.id,memberType:e.model_type}),n==="leave"&&(a(),N(x("Left workspace"))))},children:[s.jsx(T,{size:"md",className:"flex-shrink-0 text-muted",disabled:r.isPending,children:n==="leave"?s.jsx(Xs,{}):s.jsx(je,{})}),n==="leave"?s.jsx(Dt,{}):s.jsx(ta,{member:e})]})}function ta({member:e}){return s.jsx(ve,{isDanger:!0,title:s.jsx(c,{message:"Remove member"}),body:s.jsxs("div",{children:[s.jsx(c,{message:"Are you sure you want to remove `:name`?",values:{name:e.name}}),s.jsx("div",{className:"mt-8 font-semibold",children:s.jsx(c,{message:"All workspace resources created by `:name` will be transferred to workspace owner.",values:{name:e.name}})})]}),confirm:s.jsx(c,{message:"Remove"})})}function Ft({value:e,onChange:t,size:n="xs",className:r,isDisabled:a}){var d;const{data:i}=Gs(["workspaceRoles"]),o=(d=i==null?void 0:i.workspaceRoles)==null?void 0:d.find(l=>l.id===e);return!e||!o||!(i!=null&&i.workspaceRoles)?null:s.jsxs(ce,{selectionMode:"single",selectedValue:e,onSelectionChange:l=>{t(l)},children:[s.jsx(D,{className:r,size:n,variant:"flat",color:"chip",disabled:a,endIcon:s.jsx(as,{}),children:s.jsx(c,{message:o.name})}),s.jsx(de,{children:i.workspaceRoles.map(l=>s.jsx(q,{value:l.id,description:l.description,children:s.jsx(c,{message:l.name})},l.id))})]})}function na({member:e,workspace:t}){const{user:n}=_(),r=bs(t);return(n==null?void 0:n.id)===e.id?s.jsxs("div",{className:"font-medium",children:["(",s.jsx(c,{message:"You"}),")"]}):e.model_type==="invite"?s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{children:"·"}),s.jsx("div",{className:"font-medium",children:s.jsx(c,{message:"Invited"})}),r.invite?s.jsxs(s.Fragment,{children:[s.jsx("div",{children:"·"}),s.jsx(ra,{member:e,workspace:t})]}):null]}):null}function ra({member:e,workspace:t}){const n=Wr();return s.jsxs(le,{type:"modal",onClose:r=>{r&&n.mutate({workspaceId:t.id,inviteId:e.id})},children:[s.jsx(D,{variant:"link",size:"sm",color:"primary",disabled:n.isPending,children:s.jsx(c,{message:"Resend invite"})}),s.jsx(ve,{title:s.jsx(c,{message:"Resend invite"}),body:s.jsx(c,{message:"Are you sure you want to send this invite again?"}),confirm:s.jsx(c,{message:"Send"})})]})}function aa({id:e,...t}){return I.put(`workspace/${e}`,t).then(n=>n.data)}function ia(e){const{close:t}=K();return M({mutationFn:n=>aa(n),onSuccess:n=>{t(),N(x("Updated workspace")),C.invalidateQueries({queryKey:Q.fetchUserWorkspaces}),C.invalidateQueries({queryKey:Q.workspaceWithMembers(n.workspace.id)})},onError:n=>ke(n,e)})}function oa({workspace:e}){const t=Pe({defaultValues:{id:e.id,name:e.name}}),{formId:n,close:r}=K(),a=ia(t);return s.jsxs(X,{children:[s.jsx(te,{children:s.jsx(c,{message:"Rename workspace"})}),s.jsx(V,{children:s.jsx(Ee,{form:t,id:n,onSubmit:()=>{a.mutate(t.getValues())},children:s.jsx(De,{name:"name",autoFocus:!0,label:s.jsx(c,{message:"Name"}),minLength:3,required:!0})})}),s.jsxs(ge,{children:[s.jsx(D,{variant:"text",onClick:r,children:s.jsx(c,{message:"Cancel"})}),s.jsx(D,{variant:"flat",color:"primary",type:"submit",form:n,disabled:a.isPending,children:s.jsx(c,{message:"Rename"})})]})]})}function la({id:e}){return I.delete(`workspace/${e}`).then(t=>t.data)}function ca(){const{workspaceId:e,setWorkspaceId:t}=H();return M({mutationFn:n=>la(n),onSuccess:(n,r)=>{N(x("Deleted workspace")),C.invalidateQueries({queryKey:Q.fetchUserWorkspaces}),C.invalidateQueries({queryKey:Q.workspaceWithMembers(r.id)}),e===r.id&&t(Ne.id)},onError:n=>L(n)})}function da({resourceName:e,className:t,size:n="md",color:r="bgAlt",reason:a="overQuota",...i}){const o=i.message??s.jsx(ua,{resourceName:e,reason:a});return s.jsx(Nr,{color:r,size:n,className:t,description:o})}function ua({resourceName:e,reason:t}){const{billing:n}=Fe();if(t==="noWorkspacePermission")return s.jsx(c,{message:"You can't create new :name in this workspace.",values:{name:e}});const r={name:e,a:a=>s.jsx(is,{className:Pn,to:"/pricing",children:a})};return t==="overQuota"&&n.enable?s.jsx(c,{message:"Your plan is at its maximum number of :name allowed. <a>Upgrade to add more.</a>",values:r}):t==="noPermission"&&n.enable?s.jsx(c,{message:"To unlock ability to create :name. <a>Upgrade your plan.</a>",values:r}):s.jsx(c,{message:"You don't have permissions to create :name."})}function ma({onChange:e,className:t,trigger:n,placement:r="top"}){const{data:a,isFetched:i,isFetching:o}=Dn(),{setWorkspaceId:d}=H(),l=os(),[u,f]=h.useState(!1),{hasPermission:m}=_();return h.useEffect(()=>{i&&!o&&!l&&d(Ne.id)},[l,a,d,i,o]),!n&&(!l||!m("workspaces.create")&&(a==null?void 0:a.length)===1)?null:s.jsx(h.Fragment,{children:s.jsxs(le,{type:"popover",placement:r,isOpen:u,onClose:()=>{f(!1)},children:[n?h.cloneElement(n,{onClick:()=>f(!u)}):s.jsx(ha,{onClick:()=>f(!u),workspace:l,className:t}),s.jsx(X,{size:"min-w-320",children:s.jsxs(V,{padding:"p-10",children:[s.jsx("div",{className:"mb-16 border-b pb-10",children:a==null?void 0:a.map(p=>s.jsx(xa,{workspace:p,setSelectorIsOpen:f,onChange:e},p.id))}),s.jsx("div",{className:"mb-4 px-4 text-center",children:s.jsx(fa,{onClick:()=>f(!1),onCreated:p=>e==null?void 0:e(p),workspaceCount:a?a.length-1:0})})]})})]})})}function fa({onClick:e,onCreated:t,workspaceCount:n}){const{setWorkspaceId:r}=H(),{checkOverQuotaOrNoPermission:a}=_(),{overQuotaOrNoPermission:i}=a("workspaces.create","count",n);return s.jsxs(h.Fragment,{children:[s.jsx(D,{disabled:i,onClick:async o=>{o.preventDefault(),o.stopPropagation(),e();const d=await we(_r);d&&(r(d),t==null||t(d))},variant:"outline",startIcon:s.jsx(xs,{}),color:"primary",className:"h-40 w-full",children:s.jsx(c,{message:"Create new workspace"})}),i&&s.jsx(da,{size:"sm",className:"mt-12 max-w-288",resourceName:s.jsx(c,{message:"worksapces"})})]})}const ha=h.forwardRef(({workspace:e,className:t,onClick:n,...r},a)=>s.jsxs(Js,{ref:a,onClick:n,className:E("flex items-center gap-10 rounded ring-inset hover:bg-hover focus-visible:ring-2",t),...r,children:[s.jsxs("span",{className:"mr-auto block flex-auto overflow-hidden text-left",children:[s.jsx("span",{className:"block overflow-hidden overflow-ellipsis text-sm font-medium text-main",children:e.default?s.jsx(c,{message:e.name}):e.name}),s.jsx("span",{className:"block text-xs text-muted",children:e.default?s.jsx(c,{message:"Personal workspace"}):s.jsx(c,{message:":count members",values:{count:e.members_count}})})]}),s.jsx(En,{className:"shrink-0 icon-md"})]}));function xa({workspace:e,onChange:t,setSelectorIsOpen:n}){const{workspaceId:r,setWorkspaceId:a}=H(),i=r===e.id;return s.jsxs("div",{onClick:()=>{a(e.id),t==null||t(e.id),n(!1)},className:E("mb-4 flex cursor-pointer items-center gap-12 rounded-lg p-10 text-left",i&&"bg-primary/5",!i&&"hover:bg-hover"),children:[s.jsx(et,{size:"sm",className:E("flex-shrink-0 text-primary",!i&&"invisible")}),s.jsxs("div",{className:"flex-auto",children:[s.jsx("div",{className:E("text-sm",i&&"font-semibold"),children:e.name}),s.jsx("div",{className:"text-sm text-muted",children:e.default?s.jsx(c,{message:"Personal workspace"}):s.jsx(c,{message:":count members",values:{count:e.members_count}})})]}),e.id!==0&&s.jsx(va,{setSelectorIsOpen:n,workspace:e,onChange:t})]})}function pa({workspace:e,onChange:t}){const n=Et(),{user:r}=_(),{close:a}=K();return s.jsx(Dt,{isLoading:n.isPending,onConfirm:()=>{n.mutate({workspaceId:e.id,memberId:r.id,memberType:"member"},{onSuccess:()=>{a(),t==null||t(Ne.id)}})}})}function ga({workspace:e,onChange:t}){const n=ca(),{close:r}=K();return s.jsx(ve,{isDanger:!0,title:s.jsx(c,{message:"Delete workspace"}),body:s.jsx(c,{message:"Are you sure you want to delete “:name“?",values:{name:e.name}}),confirm:s.jsx(c,{message:"Delete"}),isLoading:n.isPending,onConfirm:()=>{n.mutate({id:e.id},{onSuccess:()=>{r(),t==null||t(Ne.id)}})}})}function va({setSelectorIsOpen:e,workspace:t,onChange:n}){const{user:r}=_();return s.jsxs(ce,{onItemSelected:()=>e(!1),children:[s.jsx(D,{onClick:a=>{a.preventDefault(),a.stopPropagation()},color:"primary",size:"xs",variant:"outline",endIcon:s.jsx(st,{}),children:s.jsx(c,{message:"Manage"})}),s.jsxs(de,{children:[s.jsx(q,{onClick:a=>{a.stopPropagation(),we(Gr,{workspace:t})},value:"workspaceMembers",startIcon:s.jsx(xt,{}),children:s.jsx(c,{message:"Members"})}),t.owner_id===(r==null?void 0:r.id)&&s.jsx(q,{onClick:a=>{a.stopPropagation(),we(oa,{workspace:t})},value:"updateWorkspace",startIcon:s.jsx(Nn,{}),children:s.jsx(c,{message:"Rename"})}),t.owner_id!==(r==null?void 0:r.id)&&s.jsx(q,{onClick:a=>{a.stopPropagation(),we(pa,{workspace:t,onChange:n})},value:"leaveWorkspace",startIcon:s.jsx(Xs,{}),children:s.jsx(c,{message:"Leave"})}),t.owner_id===(r==null?void 0:r.id)&&s.jsx(q,{onClick:a=>{a.stopPropagation(),we(ga,{workspace:t,onChange:n})},value:"deleteWorkspace",startIcon:s.jsx(ps,{}),children:s.jsx(c,{message:"Delete"})})]})]})}const ja=""+new URL("add-files-107c40dd.svg",import.meta.url).href,ya=""+new URL("time-management-5219b76e.svg",import.meta.url).href,Ks=""+new URL("file-searching-49556098.svg",import.meta.url).href,ba=""+new URL("throw-away-389510cc.svg",import.meta.url).href,wa=""+new URL("loving-it-585c130e.svg",import.meta.url).href,Mt=""+new URL("share-70babf29.svg",import.meta.url).href,Ae={orderBy:"updated_at",orderDir:"desc"};function ws(e){return{...Ct(e.hash),canUpload:e.permissions["files.create"]||e.permissions["files.update"],label:e.name,folder:e}}function Ct(e){return{name:"folder",uniqueId:e,label:"",path:Ze(e),hasActions:!0,canUpload:!1,sortDescriptor:Ae,isFolderPage:!0,noContentMessage:()=>({title:x("Drop files or folders here"),description:x('Or use the "Upload" button'),image:ja})}}function Ze(e){return e==="0"?"/drive":`/drive/folders/${e}`}const Sa=ls().rootFolder,R={...ws(Sa),name:"home"},Ia={name:"recent",uniqueId:"recent",label:x("Recent"),path:"/drive/recent",disableSort:!0,sortDescriptor:{orderBy:"created_at",orderDir:"desc"},queryParams:{recentOnly:!0},noContentMessage:()=>({title:x("No recent entries"),description:x("You have not uploaded any files or folders yet"),image:ya})},ae={name:"search",uniqueId:"search",label:x("Search results"),path:"/drive/search",sortDescriptor:Ae,noContentMessage:e=>e?{title:x("No matching results"),description:x("Try changing your search query or filters"),image:Ks}:{title:x("Begin typing or select a filter to search"),description:x("Search for files, folders and other content"),image:Ks}},pe={name:"sharedWithMe",uniqueId:"sharedWithMe",label:x("Shared"),path:"/drive/shares",sortDescriptor:Ae,queryParams:{sharedOnly:!0},noContentMessage:()=>({title:x("Shared with me"),description:x("Files and folders other people have shared with you"),image:Mt})},z={name:"trash",uniqueId:"trash",label:x("Trash"),path:"/drive/trash",sortDescriptor:Ae,hasActions:!0,queryParams:{deletedOnly:!0},noContentMessage:()=>({title:x("Trash is empty"),description:x("There are no files or folders in your trash currently"),image:ba})},ka={name:"starred",uniqueId:"starred",label:x("Starred"),path:"/drive/starred",sortDescriptor:Ae,queryParams:{starredOnly:!0},noContentMessage:()=>({title:x("Nothing is starred"),description:x("Add stars to files and folders that you want to easily find later"),image:wa})},Pa=[R,Ia,ae,pe,z,ka];var At=(e=>(e.DriveSidebar="drive-sidebar",e))(At||{}),Tt={};(function(e){var t=As&&As.__assign||function(){return(t=Object.assign||function(o){for(var d,l=1,u=arguments.length;l<u;l++)for(var f in d=arguments[l])Object.prototype.hasOwnProperty.call(d,f)&&(o[f]=d[f]);return o}).apply(this,arguments)},n=(Object.defineProperty(e,"__esModule",{value:!0}),{id:"id",parentId:"parentId",dataField:"data",childrenField:"children",throwIfOrphans:!1,rootParentIds:{"":!(e.countNodes=e.arrayToTree=void 0)},nestedIds:!0,assign:!1});function r(o,d){d===void 0&&(d={});for(var l,u=t(t({},n),d),f=[],m={},p=u.throwIfOrphans?new Set:null,j=0,b=o;j<b.length;j++){var v=b[j],y=u.nestedIds?i(v,u.id):v[u.id],S=u.nestedIds?i(v,u.parentId):v[u.parentId];if(u.rootParentIds[y])throw new Error("The item array contains a node whose parentId both exists in another node and is in "+'`rootParentIds` (`itemId`: "'.concat(y,'", `rootParentIds`: ').concat(Object.keys(u.rootParentIds).map(function(P){return'"'.concat(P,'"')}).join(", "),")."));Object.prototype.hasOwnProperty.call(m,y)||(m[y]=((l={})[u.childrenField]=[],l)),p&&p.delete(y),u.dataField?m[y][u.dataField]=v:u.assign?m[y]=Object.assign(v,((l={})[u.childrenField]=m[y][u.childrenField],l)):m[y]=t(t({},v),((v={})[u.childrenField]=m[y][u.childrenField],v)),v=m[y],S==null||u.rootParentIds[S]?f.push(v):(Object.prototype.hasOwnProperty.call(m,S)||(m[S]=((y={})[u.childrenField]=[],y),p&&p.add(S)),m[S][u.childrenField].push(v))}if(p!=null&&p.size)throw new Error("The items array contains orphans that point to the following parentIds: "+"[".concat(Array.from(p),"]. These parentIds do not exist in the items array. Hint: prevent orphans to result ")+"in an error by passing the following option: { throwIfOrphans: false }");if(u.throwIfOrphans&&a(f,u.childrenField)<Object.keys(m).length)throw new Error("The items array contains nodes with a circular parent/child relationship.");return f}function a(o,d){return o.reduce(function(l,u){return l+1+(u[d]&&a(u[d],d))},0)}function i(o,d){return d.split(".").reduce(function(l,u){return l&&l[u]},o)}e.arrayToTree=r,e.countNodes=a})(Tt);function Ea(e){return I.get(`users/${e.userId}/folders`,{params:e}).then(t=>t.data)}function Lt(e={}){const{user:t}=_(),{workspaceId:n}=H(),a={userId:e.userId??t.id,workspaceId:e.userId?null:n};return Z({queryKey:A.fetchUserFolders(a),queryFn:()=>Ea(a),enabled:!!t})}const Da=[];Fn();var Hs,Ys;const Bs={uploadQueueIsOpen:!1,contextMenuData:null,selectedEntries:new Set,entriesBeingDragged:[],activeActionDialog:null,sidebarExpandedKeys:[],viewMode:qe("drive.viewMode",((Ys=(Hs=ls().settings)==null?void 0:Hs.drive)==null?void 0:Ys.default_view)||"grid"),sortDescriptor:{orderBy:"updated_at",orderDir:"desc"}},w=tt()(nt((e,t)=>({...Bs,setUploadQueueIsOpen:n=>{e(r=>{r.uploadQueueIsOpen=n})},setContextMenuData:n=>{e(r=>{r.contextMenuData=n})},setSortDescriptor:n=>{e(r=>{var i;const a=(i=t().activePage)==null?void 0:i.uniqueId;a&&es("selectedSorting",{...qe("selectedSorting"),[a]:n}),r.sortDescriptor=n})},setActivePage:n=>{e(r=>{var i,o;r.activePage=n;const a=(i=qe("selectedSorting"))==null?void 0:i[n.uniqueId];r.sortDescriptor=a||n.sortDescriptor,n.uniqueId!==((o=t().activePage)==null?void 0:o.uniqueId)&&r.selectedEntries.size&&r.selectedEntries.clear()})},setEntriesBeingDragged:n=>{e(r=>{r.entriesBeingDragged=n})},setActiveActionDialog:(n,r=Da)=>{e(a=>{const i=t().activeActionDialog;((i==null?void 0:i.name)!==n||i.entries!==r)&&(a.activeActionDialog=n?{name:n,entries:r}:null)})},setViewMode:n=>{e(r=>{r.viewMode=n,es("drive.viewMode",n)})},setSidebarExpandedKeys:n=>e(r=>{r.sidebarExpandedKeys=n}),expandSidebarItem:n=>e(r=>{r.sidebarExpandedKeys.includes(n)||r.sidebarExpandedKeys.push(n)}),collapseSidebarItem:n=>e(r=>{const a=r.sidebarExpandedKeys.indexOf(n);a>-1&&r.sidebarExpandedKeys.splice(a,1)}),toggleSidebarItem:n=>e(r=>{r.sidebarExpandedKeys.includes(n)?r.expandSidebarItem(n):r.collapseSidebarItem(n)}),selectEntries:(n,r)=>{e(a=>{r||a.selectedEntries.clear(),n.forEach(i=>i&&a.selectedEntries.add(i))})},deselectEntries:n=>{e(r=>{r.selectedEntries.size&&(n==="all"?r.selectedEntries=new Set:n.forEach(a=>r.selectedEntries.delete(a)))})},reset:()=>{e(Bs)}})));function g(){return w.getState()}function Na(){const e=w(t=>t.activeActionDialog);return e==null?void 0:e.entries[0]}function Rt(){return M({mutationFn:e=>(N.loading(x("Moving [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),Fa(e)),onSuccess:(e,t)=>{B(),N(x('Moved [one 1 item|other :count items] to ":destination"',{values:{count:t.entryIds.length,destination:(e.destination||R.folder).name}}),{disableEnterAnimation:!0})},onError:e=>L(e,x("Could not move items"),null,{disableEnterAnimation:!0})})}function Fa(e){return e.destinationId=e.destinationId?e.destinationId:null,I.post("file-entries/move",e).then(t=>t.data)}const Ma=8388608;function Xe(){const e=se(d=>d.uploadMultiple),{data:t}=Pt(),{uploads:n}=Fe(),r=n.max_size||Ma,a=n.allowed_extensions,i=n.blocked_extensions;return{uploadFiles:h.useCallback((d,l={})=>{var u,f;if(l.metadata||(l.metadata={}),l.metadata.workspaceId=rt(),l.metadata.parentId||(l.metadata.parentId=((f=(u=g().activePage)==null?void 0:u.folder)==null?void 0:f.id)??null),d=[...d].map(m=>m instanceof Ts?m:new Ts(m)),t){const m=d.reduce((b,v)=>b+v.size,0),p=t.used,j=t.available;if(m+p>j){N.danger(x("You have exhausted your allowed space of :space. Delete some files or upgrade your plan.",{values:{space:t.availableFormatted}}),{action:{action:"/pricing",label:x("Upgrade")}});return}}e(d,{...l,restrictions:{maxFileSize:r,allowedFileTypes:a,blockedFileTypes:i},onSuccess:(m,p)=>{var j;(j=l==null?void 0:l.onSuccess)==null||j.call(l,m,p),B(),C.invalidateQueries({queryKey:A.fetchStorageSummary})}}),g().setUploadQueueIsOpen(!0)},[e,a,i,r,t])}}function Ss(e,t){return t.type!=="folder"||!t.permissions["files.update"]&&!e.every(n=>n.permissions["files.update"])?!1:e.every(n=>!n||t.id===n.parent_id||!n.parent_id&&t.id===0?!1:!Ca(t,n))}function Ca(e,t){const n=(e.path||"").split("/");return(t.path||"").split("/").every((a,i)=>n[i]===a)}function zt(e){const t=Rt(),{uploadFiles:n}=Xe();return{onDrop:async a=>{if(e.type==="folder"){if(a.type==="nativeFile")n(await a.getData(),{metadata:{parentId:e.id}});else if(a.type==="fileEntry"){const i=a.getData();i!=null&&i.length&&Ss(i,e)&&(t.mutate({destinationId:e.id,entryIds:i.map(o=>o.id)}),g().deselectEntries("all"))}}}}}function ns(e,t){if(e.type==="fileEntry"){const n=e.getData();return Ss(n,t)}return!0}function Is(e){return`${e.id}-tree`}function Aa(e){return`${e}`.endsWith("-tree")}function Ta({folder:e,ref:t}){const[n,r]=h.useState(!1),{onDrop:a}=zt(e);return{...Ge({id:Is(e),ref:t,types:["fileEntry","nativeFile"],acceptsDrop:o=>ns(o,e),onDragEnter:o=>{ns(o,e)&&r(!0)},onDragLeave:()=>{r(!1)},onDropActivate:()=>{g().sidebarExpandedKeys.includes(e.id)||g().setSidebarExpandedKeys([...g().sidebarExpandedKeys,e.id])},onDrop:a}),isDragOver:n}}const ks=h.createContext(null);function qt({nodes:e,itemRenderer:t,parentNode:n,level:r}){return e.map((a,i)=>h.cloneElement(t(a),{level:r==null?0:r+1,index:i,node:a,parentNode:n,key:a.id,itemRenderer:t}))}function La({children:e,nodes:t,...n}){const[r,a]=Ls(n.expandedKeys,n.defaultSelectedKeys,n.onExpandedKeysChange),[i,o]=Ls(n.selectedKeys,n.defaultSelectedKeys,n.onSelectedKeysChange),[d,l]=h.useState(),u={expandedKeys:r,setExpandedKeys:a,selectedKeys:i,setSelectedKeys:o,focusedNode:d,setFocusedNode:l};return s.jsx(ks.Provider,{value:u,children:s.jsx(Mn,{children:s.jsx(Ra,{nodes:t,itemRenderer:e})})})}function Ra(e){return s.jsx("ul",{className:"overflow-hidden text-sm",role:"tree",children:qt(e)})}const _t=h.forwardRef(({icon:e,label:t,level:n=0,node:r,className:a,...i},o)=>{const{expandedKeys:d,setExpandedKeys:l,selectedKeys:u,setSelectedKeys:f}=h.useContext(ks),m=d.includes(r.id),p=u.includes(r.id),j=b=>{b.stopPropagation();const v=d.indexOf(r.id),y=[...d];v>-1?y.splice(v,1):y.push(r.id),l(y)};return s.jsxs("div",{...i,ref:o,onClick:b=>{b.stopPropagation(),f([r.id])},className:E("header tree-label flex cursor-pointer flex-nowrap items-center gap-4 overflow-hidden text-ellipsis whitespace-nowrap rounded py-6",a,p&&"bg-primary/selected font-bold text-primary",!p&&"hover:bg-hover"),children:[n>0&&s.jsx("div",{className:"flex",children:Array.from({length:n}).map((b,v)=>s.jsx("div",{className:"h-24 w-24"},v))}),s.jsx("div",{onClick:j,children:s.jsx(ir,{className:E("cursor-default transition-transform icon-sm",m&&"rotate-90")})}),e,s.jsx("div",{className:"overflow-hidden text-ellipsis pr-6",children:t})]})});_t.displayName="TreeLabel";function za({label:e,icon:t,node:n,level:r,index:a,itemRenderer:i,labelRef:o,labelClassName:d,className:l,parentNode:u,...f}){const m=Cn(),{expandedKeys:p,selectedKeys:j,focusedNode:b,setFocusedNode:v,setExpandedKeys:y,setSelectedKeys:S}=h.useContext(ks);if(h.useEffect(()=>()=>{b===(n==null?void 0:n.id)&&v(void 0)},[b,n==null?void 0:n.id,v]),!n||!i)return null;const P=n.children.length,F=P&&p.includes(n.id),$=j.includes(n.id),re=r===0&&a===0,J=b==null?re:b===n.id,Le=k=>{var be,Ms;if(b!=null)switch(k.key){case"Enter":case" ":k.stopPropagation(),k.preventDefault(),S([b]);break;case"ArrowRight":if(k.stopPropagation(),k.preventDefault(),!P)return;F?m==null||m.focusNext():y([...p,b]);break;case"ArrowLeft":if(k.stopPropagation(),k.preventDefault(),F){const ee=p.indexOf(b),me=[...p];me.splice(ee,1),y(me)}else if(u){const ee=(Ms=(be=document.activeElement)==null?void 0:be.parentElement)==null?void 0:Ms.closest("[tabindex]");ee&&ee.focus()}break;case"ArrowDown":k.stopPropagation(),k.preventDefault(),m==null||m.focusNext();break;case"ArrowUp":k.stopPropagation(),k.preventDefault(),m==null||m.focusPrevious();break;case"Home":k.stopPropagation(),k.preventDefault(),m==null||m.focusFirst();break;case"End":k.stopPropagation(),k.preventDefault(),m==null||m.focusLast();break;case"*":if(k.stopPropagation(),k.preventDefault(),u!=null&&u.children){const ee=[...p];u.children.forEach(me=>{me.children.length&&!p.includes(me.id)&&ee.push(me.id)}),ee.length!==p.length&&y(ee)}break}};return s.jsxs("li",{role:"treeitem","aria-expanded":F?"true":"false","aria-selected":$,tabIndex:J?0:-1,onKeyDown:ss(Le),onFocus:k=>{k.stopPropagation(),v(n.id)},onBlur:k=>{k.stopPropagation(),k.currentTarget.contains(k.relatedTarget)||v(void 0)},className:E("outline-none","[&>.tree-label]:focus-visible:ring [&>.tree-label]:focus-visible:ring-2 [&>.tree-label]:focus-visible:ring-inset",l),children:[s.jsx(_t,{ref:o,className:d,node:n,level:r,label:e,icon:t,...f}),s.jsx(Y,{initial:!1,children:F?s.jsx(O.ul,{role:"group",initial:"closed",animate:"open",exit:"closed",variants:{open:{opacity:1,height:"auto"},closed:{opacity:0,height:0,overflow:"hidden"}},children:qt({nodes:n.children,parentNode:n,itemRenderer:i,level:r})},`${n.id}-group`):null})]})}function qa(){const e=ye(),{data:t}=Lt(),n=w(o=>o.sidebarExpandedKeys),r=w(o=>o.activePage);let a=[];r!=null&&r.isFolderPage&&(a=r.folder?[r.folder.id]:[]);const i=h.useMemo(()=>{const o=Tt.arrayToTree((t==null?void 0:t.folders)||[],{parentId:"parent_id",dataField:null});return[{...R.folder,children:o}]},[t==null?void 0:t.folders]);return s.jsx(La,{nodes:i,expandedKeys:n,onExpandedKeysChange:o=>{g().setSidebarExpandedKeys(o)},selectedKeys:a,onSelectedKeysChange:([o])=>{const d=$t(o,i);e(d?Ze(d):R.path)},children:()=>s.jsx(_a,{})})}function _a(e){const{node:t}=e,n=h.useRef(null),r=t.id===0,a=w(l=>l.entriesBeingDragged.includes(t.id)),{draggableProps:i}=vt({type:"fileEntry",id:Is(t),ref:n,disabled:r,hidePreview:!0,onDragStart:(l,u)=>{const f=u;g().setEntriesBeingDragged(f.getData().map(m=>m.id)),g().selectEntries([])},onDragEnd:()=>{g().setEntriesBeingDragged([])},getData:()=>[t]}),{droppableProps:o,isDragOver:d}=Ta({folder:t,ref:n});return s.jsx(za,{...We(i,o,e),onContextMenu:l=>{l.preventDefault(),l.stopPropagation(),g().deselectEntries("all"),g().setContextMenuData({x:l.clientX,y:l.clientY,entry:t})},labelRef:n,className:r?"focus-visible:ring-2":void 0,labelClassName:E(d&&"bg-primary/selected ring ring-2 ring-inset ring-primary",a&&"opacity-30",r&&"h-40"),icon:r?s.jsx(or,{size:"md",className:"mr-6"}):s.jsx(Oe,{size:"sm",className:"mr-4"}),label:t.name})}const $t=(e,t)=>{for(const n of t){if(n.id===e)return n.hash;if(n.children){const r=$t(e,n.children);if(r)return r}}};function $a(e){return I.post("file-entries/delete",e).then(t=>t.data)}function Te(){return M({mutationFn:e=>(N.loading(Oa(e),{disableExitAnimation:!0}),$a(e)),onSuccess:(e,{entryIds:t,emptyTrash:n,deleteForever:r})=>{B(),C.invalidateQueries({queryKey:A.fetchStorageSummary}),n?N(x("Emptied trash"),{disableEnterAnimation:!0}):r?N(x("Permanently deleted [one 1 item|other :count items]",{values:{count:t.length}}),{disableEnterAnimation:!0}):N(x("Moved [one 1 item|other :count items] to trash",{values:{count:t.length}}),{disableEnterAnimation:!0})},onError:(e,{emptyTrash:t})=>{const n=An(e);n?N.danger(n,{disableEnterAnimation:!0}):t?N.danger("could not empty trash",{disableEnterAnimation:!0}):N.danger("Could not delete items",{disableEnterAnimation:!0})}})}function Oa(e){return e.emptyTrash?x("Emptying trash..."):e.deleteForever?x("Deleting files..."):x("Moving to trash...")}function Ka(){return s.jsxs("div",{className:"mt-26 px-12 text-muted",children:[s.jsx(qa,{}),s.jsx(Ln,{menu:At.DriveSidebar,orientation:"vertical",gap:"gap-0",children:e=>e.action==="/drive/trash"?s.jsx(Ba,{item:e},e.id):s.jsx(Ot,{item:e},e.id)})]})}const Ot=h.forwardRef(({item:e,className:t,...n},r)=>s.jsx(Tn,{className:({isActive:a})=>E(t,"my-4 h-40 w-full rounded px-24",a?"cursor-default bg-primary/selected font-bold text-primary":"hover:bg-hover"),item:e,ref:r,...n}));function Ba({item:e}){const t=Te(),[n,r]=h.useState(!1),a=h.useRef(null),{droppableProps:i}=Ge({id:"trash",types:["fileEntry"],ref:a,onDragEnter:()=>{r(!0)},onDragLeave:()=>{r(!1)},onDrop:o=>{const d=o.getData().map(l=>l.id);t.mutate({entryIds:d,deleteForever:!1})}});return s.jsx(Ot,{className:E(n&&"bg-primary/selected"),ref:a,...i,item:e})}function Kt({isCompact:e,className:t}){const n=w(i=>i.activePage),{uploadFiles:r}=Xe(),a=e?s.jsx(T,{size:"md",disabled:!(n!=null&&n.canUpload),children:s.jsx(xs,{})}):s.jsx(D,{className:"min-w-160",color:"primary",variant:"flat",size:"sm",startIcon:s.jsx(pt,{}),disabled:!(n!=null&&n.canUpload),children:s.jsx(c,{message:"Upload"})});return s.jsx("div",{className:t,children:s.jsxs(ce,{onItemSelected:async i=>{var o;if(i==="uploadFiles")r(await _e({multiple:!0}));else if(i==="uploadFolder")r(await _e({directory:!0}));else if(i==="newFolder"){const d=(o=g().activePage)==null?void 0:o.folder;g().setActiveActionDialog("newFolder",d?[d]:[])}},children:[a,s.jsxs(de,{children:[s.jsx(q,{value:"uploadFiles",startIcon:s.jsx(lr,{}),children:s.jsx(c,{message:"Upload files"})}),s.jsx(q,{value:"uploadFolder",startIcon:s.jsx(gt,{}),children:s.jsx(c,{message:"Upload folder"})}),s.jsx(q,{value:"newFolder",startIcon:s.jsx(hs,{}),children:s.jsx(c,{message:"Create folder"})})]})]})})}function Ua({className:e}){const{isSubscribed:t}=_(),{billing:n}=Fe();return s.jsxs("div",{className:E(e,"flex flex-col gap-20 border-r bg-alt text-sm font-medium text-muted"),children:[s.jsxs("div",{className:"compact-scrollbar flex-auto overflow-y-auto",children:[s.jsx(Kt,{className:"px-12 pt-28 text-center"}),s.jsx(Ka,{}),s.jsx(Rr,{}),n.enable?s.jsx("div",{className:"mt-14 pl-60",children:s.jsx(D,{elementType:is,to:t?"/billing/change-plan":"/pricing",variant:"outline",color:"primary",size:"xs",children:s.jsx(c,{message:"Upgrade"})})}):null]}),s.jsx(Wa,{})]})}function Wa(){const e=ye();return s.jsx(ma,{onChange:()=>{e(R.path)},className:"mt-auto w-full flex-shrink-0 border-t px-24 py-18"})}function Bt(e={}){const t=w(u=>u.activePage),n=w(u=>u.sortDescriptor),[r]=cs(),{workspaceId:a}=H(),{userId:i}=e,o={orderBy:n==null?void 0:n.orderBy,orderDir:n==null?void 0:n.orderDir,section:(t==null?void 0:t.name)||"folder",...t==null?void 0:t.queryParams,...Object.fromEntries(r),folderId:t!=null&&t.isFolderPage?t.uniqueId:"0"};i!=null?(o.userId=i,delete o.workspaceId):o.workspaceId=a;const d=t===ae&&!o.query&&!o.filters,l=ys({queryKey:A.fetchEntries(o),queryFn:({pageParam:u=1})=>{const f={...o,page:u},m=i!=null?`drive/users/${i}/file-entries`:"drive/file-entries";return console.log("Making request to:",m,"with params:",f),I.get(m,{params:f}).then(p=>p.data)},initialPageParam:1,getNextPageParam:u=>{const f=u.current_page;if(at(u))return f+1},enabled:!d,gcTime:0,refetchOnMount:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1,staleTime:3e4});return h.useEffect(()=>{var u,f;(f=(u=l.data)==null?void 0:u.pages[0])!=null&&f.folder&&Qa(l.data)},[l.data]),l}function Qa(e){var r;const t=e.pages[0].folder;if(!t)return;const n=(r=w.getState().activePage)==null?void 0:r.folder;(!n||n.id!==t.id||n.hash!==t.hash)&&g().setActivePage(ws(t))}function Va(){return C.getQueriesData({queryKey:A.fetchEntries()}).reduce((t,n)=>{const r=n[1]?n[1].pages.flatMap(a=>a.data):[];return[...t,...r]},[])}function Ha(e,t){const n={...e};n.left=Math.max(0,n.left);const r=n.left-e.left;r>0&&(n.width-=r),n.top=Math.max(0,n.top);const a=n.top-e.top;return a>0&&(n.height-=a),n.width=Math.min(n.width,t.width-n.left),n.height=Math.min(n.height,t.height-n.top),n}const Se=new Map;function Ya(e){const{id:t,ref:n}=e,r=h.useRef(e);r.current=e,h.useLayoutEffect(()=>{if(n.current)return Se.set(t,{...Se.get(t),id:t,ref:n,onSelected:()=>{var a,i;(i=(a=r.current).onSelected)==null||i.call(a)},onDeselected:()=>{var a,i;return(i=(a=r.current).onDeselected)==null?void 0:i.call(a)}}),()=>{jt.delete(t)}},[t,r,n])}function Ga(e,t){return!e||!t?!1:e.left<=t.left+t.width&&e.left+e.width>=t.left&&e.top<=t.top+t.height&&e.top+e.height>=t.top}function Za({onPointerDown:e,...t}={}){const n=h.useRef(null),r=t.containerRef||n,a=h.useRef(null);let i=h.useRef({}).current;const o=()=>{var S,P,F,$,re,J,Le;if(i.rafId&&cancelAnimationFrame(i.rafId),!i.startPoint||!i.endPoint||!i.boundaryRect)return;const l=i.startPoint,u=i.endPoint,f=l.scrollTop||0,m=((S=r.current)==null?void 0:S.scrollTop)||0,p={left:Math.min(l.x,u.x),top:Math.min(l.y,u.y),width:Math.abs(l.x-u.x),height:Math.abs(l.y-u.y)};p.left-=i.boundaryRect.left,p.top-=i.boundaryRect.top,p.top+=f;const j=m-f,b=Math.abs(j);j<0&&(p.top-=b),p.height+=b;const v=i.boundaryRect?Ha(p,i.boundaryRect):{...p};a.current&&(i.rafId=requestAnimationFrame(()=>{a.current&&(a.current.style.display="block",a.current.style.transform=`translate(${v.left}px, ${v.top}px)`,a.current.style.width=`${v.width}px`,a.current.style.height=`${v.height}px`),i.rafId=void 0}));const y={...v,left:v.left+i.boundaryRect.left,top:v.top+i.boundaryRect.top-m};for(const[,k]of Se){const be=Ga(k.rect,y);be&&!((P=i.selectedIds)!=null&&P.has(k.id))?((F=i.selectedIds)==null||F.add(k.id),($=k.onSelected)==null||$.call(k)):!be&&((re=i.selectedIds)!=null&&re.has(k.id))&&((J=i.selectedIds)==null||J.delete(k.id),(Le=k.onDeselected)==null||Le.call(k))}};return{containerProps:{...it({minimumMovement:4,onPointerDown:e,onMoveStart:l=>{if(Sr)return!1;_s(Se),i={selectedIds:new Set};const u=r.current;if(i.startPoint={x:l.clientX,y:l.clientY,scrollTop:(u==null?void 0:u.scrollTop)||0},i.scrollListener=f=>{var m;i.startPoint&&(_s(Se),(m=i.boundaryRect)!=null&&m.height&&(i.boundaryRect.height=f.target.scrollHeight),o())},u){const f=u.getBoundingClientRect();u.addEventListener("scroll",i.scrollListener),i.boundaryRect={top:f.top,left:f.left,height:u.scrollHeight,heightWithoutScroll:f.height,width:u.scrollWidth}}},onMove:l=>{if(i.endPoint={x:l.clientX,y:l.clientY},i.boundaryRect&&r.current){const u=l.clientY+20>i.boundaryRect.heightWithoutScroll+i.boundaryRect.top,f=l.clientY-20<i.boundaryRect.top;u?r.current.scrollBy({top:10}):f&&r.current.scrollBy({top:-10})}o()},onMoveEnd:()=>{i.rafId&&cancelAnimationFrame(i.rafId),r.current&&i.scrollListener&&r.current.removeEventListener("scroll",i.scrollListener),a.current&&(a.current.style.display="none",a.current.style.transform="",a.current.style.width="",a.current.style.height=""),i={}}}).domProps,ref:r},boxProps:{ref:a}}}function Ps(e={}){const t=Bt(e);return t.data?t.data.pages.flatMap(n=>n.data):[]}function Ut(){const e=w(n=>n.selectedEntries),t=Ps();return Array.from(e).map(n=>t.find(r=>r.id===n)).filter(n=>!!n)}function Wt(){return Ut()[0]}function Xa(){const e=Wt(),{data:t}=Lt();if(!(!e||!(t!=null&&t.folders)))return t.folders.find(n=>n.id===e.parent_id)}function Qt(){const e=Array.from(g().selectedEntries),t=Va();return e.map(n=>t.find(r=>r.id===n)).filter(n=>!!n)}function Ja(){return Rn("((pointer: coarse))")}function Vt(e){const t=Ja(),n=h.useRef(null),{onDrop:r}=zt(e),[a,i]=h.useState(!1),o=w(m=>m.entriesBeingDragged.includes(e.id)),d=w(m=>m.activePage),{draggableProps:l}=vt({disabled:!!t||d===z,id:e.id,type:"fileEntry",ref:n,hidePreview:!0,onDragStart:(m,p)=>{g().selectedEntries.has(e.id)||g().selectEntries([e.id]),g().setEntriesBeingDragged(p.getData().map(j=>j.id))},onDragEnd:()=>{g().setEntriesBeingDragged([])},getData:()=>Qt()}),{droppableProps:u}=Ge({id:e.id,disabled:t||e.type!=="folder",ref:n,types:["fileEntry","nativeFile"],acceptsDrop:m=>ns(m,e),onDragEnter:()=>i(!0),onDragLeave:()=>i(!1),onDrop:r});Ya({id:e.id,ref:n,onSelected:()=>{g().selectEntries([e.id],!0)},onDeselected:()=>{g().deselectEntries([e.id])}});const f=E(o&&"opacity-20",a&&"ring ring-offset-4 ring-primary bg-primary-light/10 rounded");return{draggableProps:l,droppableProps:u,isDragOver:a,isDragging:o,itemClassName:f,ref:n}}function ei({item:e,children:t,className:n,...r}){const{isCollapsedMode:a}=h.useContext(ds),{draggableProps:i,droppableProps:o,itemClassName:d,ref:l}=Vt(e);return s.jsx("div",{className:E(n,d),ref:l,...We(i,o,r,{onContextMenu:u=>{u.preventDefault(),u.stopPropagation(),a||(g().selectedEntries.has(e.id)||g().selectEntries([e.id]),g().setContextMenuData({x:u.clientX,y:u.clientY}))}}),children:t})}function Ht(){const e=ye();return{performViewItemAction:h.useCallback(n=>{if(n&&n.type==="folder")g().activePage===z?g().setActiveActionDialog("trashFolderBlock",[n]):e(Ze(n.hash));else{const r=Qt();g().setActiveActionDialog("preview",r.length?r:[n])}},[e])}}function si(e){return e?I.post(`file-entries/${e}/shareable-link`).then(t=>t.data):Promise.reject(new Error("Invalid entry id"))}function Yt(){return M({mutationFn:({entryId:e})=>si(e),onSuccess:(e,{entryId:t})=>{C.setQueryData(A.fetchEntryShareableLink(t),e)},onError:e=>L(e,x("Could not create link"))})}function ti({entryIds:e}){return I.post("file-entries/star",{entryIds:e}).then(t=>t.data)}function ni(){return M({mutationFn:e=>ti(e),onSuccess:(e,{entryIds:t})=>{B(),N(x("Starred [one 1 item|other :count items]",{values:{count:t.length}}))},onError:e=>L(e,x("Could not star items"))})}function ri({entryIds:e}){return I.post("file-entries/unstar",{entryIds:e}).then(t=>t.data)}function ai(){return M({mutationFn:e=>ri(e),onSuccess:(e,{entryIds:t})=>{B(),N(x("Removed star from [one 1 item|other :count items]",{values:{count:t.length}}))},onError:e=>L(e,x("Could not remove star"))})}function ii(e){return I.post("file-entries/duplicate",e).then(t=>t.data)}function oi(){return M({mutationFn:e=>(N.loading(x("Duplicating [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),ii(e)),onSuccess:(e,t)=>{B(),C.invalidateQueries({queryKey:A.fetchStorageSummary}),N(x("Duplicated [one 1 item|other :count items]",{values:{count:t.entryIds.length}}),{disableEnterAnimation:!0})},onError:e=>L(e,x("Could not duplicate items"),null,{disableEnterAnimation:!0})})}function Gt(){return M({mutationFn:e=>li(e),onSuccess:()=>B()})}function li({entryIds:e,...t}){return I.post(`file-entries/${e.join(",")}/unshare`,t).then(n=>n.data)}function Zt(){return M({mutationFn:e=>ci(e),onSuccess:(e,t)=>{B(),N(x("Restored [one 1 item|other :count items]",{values:{count:t.entryIds.length}}))},onError:e=>L(e,x("Could not restore items"))})}function ci(e){return I.post("file-entries/restore",e).then(t=>t.data)}function di(e){const t=Xt(e),n=Es(e),r=ui(e),a=mi(e),i=fi(e),o=hi(e),d=xi(e),l=pi(e),u=gi(e),f=Jt(e),m=en(e),p=vi(e);return[t,n,r,a,i,o,d,l,u,f,m,p].filter(j=>!!j)}function Xt(e){if(e.some(t=>t.type!=="folder"))return{label:x("Preview"),icon:cr,key:"preview",execute:()=>{g().setActiveActionDialog("preview",e)}}}function Es(e){const t=w(n=>n.activePage);if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||t===z))return{label:x("Share"),icon:xt,key:"share",execute:()=>{g().setActiveActionDialog("share",e)}}}function ui(e){const t=w(r=>r.activePage),n=Yt();if(!(e.length>1||!e.every(r=>r.permissions["files.update"])||t===z))return{label:x("Get link"),icon:Ir,key:"getLink",execute:()=>{n.mutate({entryId:e[0].id}),g().setActiveActionDialog("getLink",e)}}}function mi(e){const t=w(r=>r.activePage),n=ni();if(!(e.every(r=>{var a;return(a=r.tags)==null?void 0:a.find(i=>i.name==="starred")})||!e.every(r=>r.permissions["files.update"])||t===z))return{label:x("Add to starred"),icon:dr,key:"addToStarred",execute:()=>{n.mutate({entryIds:e.map(r=>r.id)}),g().selectEntries([])}}}function fi(e){const t=w(r=>r.activePage),n=ai();if(!(!e.every(r=>{var a;return(a=r.tags)==null?void 0:a.find(i=>i.name==="starred")})||t===z))return{label:x("Remove from starred"),icon:ur,key:"removeFromStarred",execute:()=>{n.mutate({entryIds:e.map(r=>r.id)}),g().selectEntries([])}}}function hi(e){const t=w(n=>n.activePage);if(!(!e.every(n=>n.permissions["files.update"])||t===pe||t===z))return{label:x("Move to"),icon:mr,key:"moveTo",execute:()=>{g().setActiveActionDialog("moveTo",e)}}}function xi(e){const t=w(n=>n.activePage);if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||t===z))return{label:x("Rename"),icon:fr,key:"rename",execute:()=>{g().setActiveActionDialog("rename",e)}}}function pi(e){const t=w(r=>r.activePage),n=oi();if(!(e.length>1||!e.every(r=>r.permissions["files.update"])||t===z))return{label:x("Make a copy"),icon:hr,key:"makeCopy",execute:()=>{var r;n.mutate({entryIds:e.map(a=>a.id),destinationId:(r=t==null?void 0:t.folder)==null?void 0:r.id}),g().selectEntries([])}}}function gi(e){const{downloadUrl:t}=yt(e[0],{downloadHashes:e.map(n=>n.hash)});if(e.every(n=>n.permissions["files.download"]))return{label:x("Download"),icon:Ke,key:"download",execute:()=>{t&&Be(t),g().selectEntries([])}}}function Jt(e){const t=Te(),n=w(r=>r.activePage);if(!(n===pe||!e.every(r=>r.permissions["files.delete"])))return{label:n===z?x("Delete forever"):x("Remove"),icon:ps,key:"delete",execute:()=>{n===z?g().setActiveActionDialog("confirmAndDeleteForever",e):(t.mutate({entryIds:e.map(r=>r.id),deleteForever:n===z}),g().selectEntries([]))}}}function vi(e){const t=Zt();if(!(w(r=>r.activePage)!==z||!e.every(r=>r.permissions["files.delete"])))return{label:x("Restore"),icon:xr,key:"restore",execute:()=>{t.mutate({entryIds:e.map(r=>r.id)}),g().selectEntries([])}}}function en(e){const t=Gt();if(w(r=>r.activePage)===pe)return{label:x("Remove"),icon:ps,key:"removeSharedEntry",execute:()=>{t.mutate({entryIds:e.map(r=>r.id),userId:"me"},{onSuccess:(r,a)=>{N(x("Removed [one 1 item|other {count} items]",{values:{count:a.entryIds.length}}))},onError:r=>L(r,x("Could not remove items"))}),g().selectEntries([])}}}function ji(e){const t=yi(e),n=bi(e),r=wi(e),a=Si();return[t,n,r,a].filter(i=>!!i)}function yi(e){if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:x("New folder"),icon:hs,key:"newFolder",execute:()=>{e.folder&&g().setActiveActionDialog("newFolder",[e.folder])}}}function bi(e){const{uploadFiles:t}=Xe();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:x("Upload files"),icon:pt,key:"uploadFiles",execute:async()=>{t(await _e({multiple:!0}))}}}function wi(e){const{uploadFiles:t}=Xe();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:x("Upload folder"),icon:gt,key:"uploadFolder",execute:async()=>{t(await _e({directory:!0}))}}}function Si(e){const t=Te();if(w(r=>r.activePage)===z)return{label:x("Empty trash"),icon:pr,key:"emptyTrash",execute:()=>{t.mutate({entryIds:[],emptyTrash:!0}),g().selectEntries([])}}}function Je({children:e,entries:t,page:n,showIfNoActions:r}){return(n==null?void 0:n.name)===R.name?s.jsx(Ws,{page:R,showIfNoActions:r,children:e}):n===z?s.jsx(Ws,{page:z,showIfNoActions:r,children:e}):n!=null&&n.folder?s.jsx(Us,{entries:[n.folder],showIfNoActions:r,children:e}):t!=null&&t.length?s.jsx(Us,{entries:t,showIfNoActions:r,children:e}):null}function Us({entries:e,children:t,showIfNoActions:n}){const r=di(e);return s.jsx(sn,{actions:r,showIfNoActions:n,children:t})}function Ws({page:e,children:t,showIfNoActions:n}){const r=ji(e);return s.jsx(sn,{actions:r,showIfNoActions:n,children:t})}function sn({actions:e,children:t,showIfNoActions:n}){return!e.length&&!n?null:s.jsxs(ce,{children:[t,s.jsx(de,{children:e.map(r=>s.jsx(q,{onSelected:()=>{r.execute()},value:r.key,startIcon:h.createElement(r.icon),children:s.jsx(c,{...r.label})},r.key))})]})}const tn=zn(e=>xe(e)),Ds=[{key:"name",allowsSorting:!0,header:()=>s.jsx(c,{message:"Name"}),visibleInMode:"all",width:"flex-3 min-w-200",body:e=>s.jsx(Ii,{entry:e})},{key:"updated_at",allowsSorting:!0,maxWidth:"max-w-184",header:()=>s.jsx(c,{message:"Last modified"}),body:e=>s.jsx($e,{date:e.updated_at})},{key:"file_size",allowsSorting:!0,header:()=>s.jsx(c,{message:"Size"}),maxWidth:"max-w-144",body:e=>tn(e.file_size)??"-"},{key:"actions",hideHeader:!0,header:()=>s.jsx(c,{message:"Actions"}),align:"end",width:"w-42 flex-shrink-0",visibleInMode:"all",body:e=>s.jsx(ki,{entry:e})}];function Ii({entry:e}){const{isCollapsedMode:t}=h.useContext(ds),n=t?"w-30 h-30":"w-24 h-24";return s.jsxs("div",{className:"flex items-center gap-14",children:[s.jsx(gs,{className:E("rounded",n),iconClassName:n,file:e}),s.jsxs("div",{className:"min-w-0",children:[s.jsx("div",{className:"overflow-hidden overflow-ellipsis",children:e.name}),t&&s.jsxs("div",{className:"mt-4 flex items-center text-xs text-muted",children:[s.jsx($e,{date:e.updated_at}),s.jsx("div",{children:"·"}),s.jsx("div",{children:tn(e.file_size)})]})]})]})}function ki({entry:e}){const{selectedRows:t}=h.useContext(ds);return t.length?s.jsx(ot,{className:"mr-8 block",checked:t.includes(e.id)}):s.jsx(Je,{entries:[e],children:s.jsx(T,{className:"text-muted",children:s.jsx(vs,{})})})}function Pi({entries:e}){const{performViewItemAction:t}=Ht(),n=w(i=>i.selectedEntries),r=w(i=>i.sortDescriptor),a=h.useMemo(()=>[...n],[n]);return s.jsx(lt,{columns:Ds,data:e,sortDescriptor:r,onSortChange:i=>{g().setSortDescriptor(i)},onAction:t,selectedRows:a,selectionStyle:"highlight",renderRowAs:ei,onSelectionChange:i=>{g().selectEntries(i)}})}const nn=qn.forwardRef(({entry:e,className:t,isSelected:n,isMobileMode:r,footerAdornment:a,...i},o)=>s.jsxs("div",{...i,ref:o,className:E("grid-item flex aspect-square select-none flex-col overflow-hidden rounded border shadow outline-none transition-shadow-opacity dark:bg-alt",n&&"border-primary",t),children:[s.jsx("div",{className:"relative min-h-0 flex-auto",children:s.jsx(gs,{className:"h-full w-full",iconClassName:"block w-70 h-70 absolute m-auto inset-0",file:e})}),s.jsx(Ei,{entry:e,isSelected:n,isMobile:r,adornment:a})]}));function Ei({entry:e,isSelected:t,isMobile:n,adornment:r}){return s.jsxs("div",{className:E("flex h-48 flex-shrink-0 items-center text-sm",n?"justify-between gap-10 pl-18 pr-2":"justify-center px-16",t&&"bg-primary-light/20"),children:[s.jsx("div",{className:"min-w-0 overflow-hidden overflow-ellipsis whitespace-nowrap",children:e.name}),r]})}function Di({entry:e}){const t=w(j=>j.selectedEntries.has(e.id)),{performViewItemAction:n}=Ht(),{isMobileMode:r}=h.useContext(ue),{draggableProps:a,droppableProps:i,itemClassName:o,ref:d}=Vt(e),l=()=>{t?g().deselectEntries([e.id]):g().selectEntries([e.id],!0)},u=(j,b)=>{r?g().selectedEntries.size?l():n(e):_n(j)?l():g().selectEntries([e.id])},{domProps:f}=it({onLongPress:r?()=>l():void 0,onPress:u}),m=j=>{(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),j.stopPropagation(),n(e))},p=j=>{j.preventDefault(),j.stopPropagation(),r||(g().selectedEntries.has(e.id)||g().selectEntries([e.id]),g().setContextMenuData({x:j.clientX,y:j.clientY}))};return s.jsx(nn,{...We(a,i,f,{onKeyDown:ss(m)}),ref:d,entry:e,isSelected:t,isMobileMode:!!r,tabIndex:-1,onDoubleClick:j=>{j.preventDefault(),j.stopPropagation(),r||n(e)},footerAdornment:r&&s.jsx(Ni,{entry:e,isSelected:t}),onContextMenu:ss(p),className:o})}function Ni({entry:e,isSelected:t}){return w(r=>r.selectedEntries.size)?s.jsx(ot,{className:"mr-8 block",checked:t}):s.jsx(Je,{entries:[e],children:s.jsx(T,{className:"text-muted",onPointerDown:r=>{r.stopPropagation()},children:s.jsx(vs,{})})})}function Fi({entries:e}){return s.jsx("div",{className:"file-grid-container",children:s.jsx("div",{className:"file-grid",children:e.map(t=>s.jsx(Di,{entry:t},t.id))})})}function Ns({hash:e,params:t,isEnabled:n=!0}){return Z({queryKey:A.fetchFolderPath(e,t),queryFn:()=>Mi(e,t),enabled:!!e&&n})}function Mi(e,t){return I.get(`folders/${e}/path`,{params:t}).then(n=>n.data)}function rn({className:e}){const{isMobileMode:t}=h.useContext(ue),n=ye(),r=w(f=>f.activePage),a=r==null?void 0:r.folder,i=Ns({hash:a==null?void 0:a.hash,isEnabled:(a==null?void 0:a.hash)!==R.folder.hash}),o=os(),d=Ci(),l=!r||!o||r.isFolderPage&&!a||i.fetchStatus!=="idle";let u;if(l)u=null;else{const f=d?[d]:[];i.data&&i.data.path.forEach(m=>{f.push({page:ws(m),label:m.name})}),u=s.jsx(js,{className:e,size:t?"md":"lg",currentIsClickable:!0,children:f.map((m,p)=>p===f.length-1?s.jsx(Ie,{children:({isMenuItem:b})=>b||!m.page.folder&&m.page!==z?s.jsx(ze,{value:m.label}):s.jsx(Je,{page:m.page,showIfNoActions:!0,children:s.jsxs(Js,{className:"flex items-center gap-2 rounded focus-visible:ring-offset-4",children:[s.jsx(ze,{value:m.label}),s.jsx(as,{className:"text-muted icon-md"})]})})},m.page.uniqueId):s.jsx(Ie,{onSelected:()=>{n(m.page.path)},children:s.jsx(ze,{value:m.label})},m.page.uniqueId))})}return u}function Ci(){var r,a;const e=w(i=>i.activePage),t=os(),{user:n}=_();if(!e)return null;if(t&&!t.default&&e!=null&&e.isFolderPage&&((e==null?void 0:e.name)===R.name||((r=e.folder)==null?void 0:r.workspace_id)===t.id))return{label:t.name,page:R};if(e!=null&&e.isFolderPage){const i=(a=e.folder)==null?void 0:a.users.find(o=>o.owns_entry);return(i==null?void 0:i.id)!==(n==null?void 0:n.id)?{label:pe.label,page:pe}:{label:R.label,page:R}}return{label:e.label,page:e}}function an({query:{isInitialLoading:e,fetchNextPage:t,isFetchingNextPage:n,hasNextPage:r},children:a,loaderMarginTop:i="mt-24",style:o,className:d,variant:l="infiniteScroll",loadMoreExtraContent:u,size:f="sm"}){const m=h.useRef(null),p=n||e,[j,b]=h.useState(0),v=l==="loadMore"&&j<3?"loadMore":"infiniteScroll",y=h.useRef(!1);h.useEffect(()=>{const P=m.current;if(!P||v==="loadMore")return;const F=new IntersectionObserver(([$])=>{if($.isIntersecting){if(!y.current)return;r&&!p&&(y.current=!1,t())}else y.current=!0});return F.observe(P),()=>{F.unobserve(P)}},[t,r,p,v]);let S;return a?S=n?a:null:v==="loadMore"?S=!e&&r&&s.jsxs("div",{className:E("flex items-center gap-8",i),children:[u,s.jsx(D,{size:f==="md"?"sm":"xs",className:E(f==="sm"?"min-h-24 min-w-96":"min-h-36 min-w-112"),variant:"outline",color:"primary",onClick:()=>{t(),b(j+1)},disabled:p,children:j>=2&&!n?s.jsx(c,{message:"Load all"}):s.jsx(c,{message:"Show more"})})]}):S=s.jsx(Y,{children:n&&s.jsx(O.div,{className:E("flex w-full justify-center",i),...us,children:s.jsx(G,{size:f,isIndeterminate:!0,"aria-label":"loading"})})}),s.jsxs("div",{style:o,className:E("w-full",d,r&&"min-h-36"),role:"presentation",children:[s.jsx("div",{ref:m,"aria-hidden":!0}),S]})}function Ai({isVisible:e}){const t=s.jsx(O.div,{...us,transition:{duration:.3},className:"pointer-events-none absolute inset-0 min-h-full w-full border-2 border-dashed border-primary bg-primary-light/30",children:s.jsx(O.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"fixed bottom-0 left-0 right-0 mx-auto max-w-max rounded bg-primary p-10 text-on-primary",children:s.jsx(c,{message:"Drop files to upload them to this folder."})})},"dragTargetMask");return s.jsx(Y,{children:e?t:null})}const Qs=[{id:"file_size",label:x("Size")},{id:"name",label:x("Name")},{id:"updated_at",label:x("Last modified")},{id:"created_at",label:x("Upload date")},{id:"type",label:x("Type")},{id:"extension",label:x("Extension")}];function on({descriptor:e,onChange:t,isDisabled:n=!1}){const r=e.orderBy,a=e.orderDir,i=Qs.find(o=>o.id===r);return s.jsxs(ce,{showCheckmark:!0,selectionMode:"multiple",selectedValue:[a||"desc",r||""],onItemSelected:o=>{t(o==="asc"||o==="desc"?{orderBy:r,orderDir:o}:{orderBy:o,orderDir:a})},children:[s.jsx(D,{className:"text-muted",variant:"text",size:"sm",startIcon:s.jsx(gr,{}),disabled:n,children:i?s.jsx(c,{...i.label}):null}),s.jsxs(de,{children:[s.jsxs(Rs,{label:s.jsx(c,{message:"Direction"}),children:[s.jsx(q,{value:"asc",children:s.jsx(c,{message:"Ascending"})}),s.jsx(q,{value:"desc",children:s.jsx(c,{message:"Descending"})})]}),s.jsx(Rs,{label:s.jsx(c,{message:"Sort By"}),children:Qs.map(o=>s.jsx(q,{value:o.id,children:s.jsx(c,{...o.label})},o.id))})]})]})}function ln({isDisabled:e}){const t=w(n=>n.sortDescriptor);return s.jsx(on,{isDisabled:e,descriptor:t,onChange:n=>{g().setSortDescriptor(n)}})}function cn({className:e}){const t=Ut();return t.length?s.jsx("div",{className:e,children:s.jsx(Ti,{entries:t})}):null}function Ti({entries:e}){const t=Xt(e),n=Es(e),r=Jt(e),a=en(e),i=[t,n,r,a].filter(o=>!!o);return s.jsxs("div",{className:"entry-action-list",children:[i.map(o=>s.jsx(oe,{label:s.jsx(c,{...o.label}),children:s.jsx(T,{size:"sm",onClick:()=>{o.execute()},children:h.createElement(o.icon)})},o.key)),s.jsx(Je,{entries:e,children:s.jsx(oe,{label:s.jsx(c,{message:"More actions"}),children:s.jsx(T,{children:s.jsx(vs,{})})})})]})}function Li(){const e=w(t=>t.activePage);return s.jsxs("div",{className:"my-10 flex min-h-42 items-center justify-between gap-40 px-10 text-muted md:px-18",children:[s.jsx(ln,{isDisabled:e==null?void 0:e.disableSort}),s.jsx(cn,{className:"text-muted"})]})}function Ri({className:e}){const{userId:t}=Qe(),[n]=cs(),[r,a]=h.useState(!1),i=h.useRef(null),{selectedEntries:o,viewMode:d,activePage:l}=w(),{mutate:u}=Te(),{isMobileMode:f}=h.useContext(ue),m={userId:t?parseInt(t):void 0},p=Bt(m),j=Ps(m),{droppableProps:b}=Ge({id:"driveRoot",ref:i,types:["nativeFile"],onDragEnter:()=>a(!0),onDragLeave:()=>a(!1),onDrop:()=>a(!1)}),v=F=>{F.key==="Delete"&&o.size>0&&u({entryIds:Array.from(o)})},y=F=>{const $=F.target;return F.button===2||$.closest('button, input, [role="button"]')!=null},{containerProps:S}=Za({onPointerDown:y,containerRef:i});let P;if(!j.length&&(!p.isLoading||p.fetchStatus==="idle")){const F=l==null?void 0:l.noContentMessage(!!n.get("query"));F&&(P=s.jsx(Ve,{className:"mt-40",image:s.jsx(Me,{src:F.image}),title:s.jsx(c,{...F.title}),description:s.jsx(c,{...F.description})}))}else P=d==="list"?s.jsx(Pi,{entries:j}):s.jsx(Fi,{entries:j});return s.jsx("div",{...We(S,b,{onKeyDown:v}),className:e,ref:i,children:s.jsxs("div",{className:"relative flex min-h-full flex-col pt-10",children:[f?s.jsx(rn,{className:"mb-10 px-14"}):s.jsx(Li,{}),s.jsxs("div",{className:"relative flex-auto px-18 pb-18 md:px-24",children:[P,s.jsx(an,{query:p,variant:"infiniteScroll"})]}),s.jsx(Ai,{isVisible:r})]})})}const zi=h.memo(({file:e,style:t})=>s.jsxs("div",{className:"absolute left-0 top-0 flex w-full items-center gap-14 p-10",style:t,children:[s.jsx("div",{className:"shrink-0 rounded border p-8",children:s.jsx(Ce,{className:"h-22 w-22",mime:e.mime})}),s.jsxs("div",{className:"min-w-0 flex-auto pr-10",children:[s.jsx("div",{className:"mb-2 flex min-w-0 items-center gap-10",children:s.jsx("div",{className:"min-w-0 flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:e.name})}),s.jsx(qi,{file:e})]}),s.jsx("div",{className:"mr-10",children:s.jsx(_i,{file:e})})]}));function qi({file:e}){const t=se(o=>o.fileUploads.get(e.id)),n=(t==null?void 0:t.bytesUploaded)||0,r=h.useMemo(()=>xe(e.size),[e]),a=h.useMemo(()=>xe(n),[n]);let i;return(t==null?void 0:t.status)==="completed"?i=s.jsx(c,{message:"Upload complete"}):(t==null?void 0:t.status)==="aborted"?i=s.jsx(c,{message:"Upload cancelled"}):(t==null?void 0:t.status)==="failed"?i=s.jsx(c,{message:"Upload failed"}):i=s.jsx(c,{message:":bytesUploaded of :totalBytes",values:{bytesUploaded:a,totalBytes:r}}),s.jsx("div",{className:"text-xs text-muted",children:i})}function _i({file:e}){const t=se(m=>m.fileUploads.get(e.id)),n=se(m=>m.abortUpload),r=(t==null?void 0:t.percentage)||0,a=t==null?void 0:t.status,i=t==null?void 0:t.errorMessage,[o,d]=h.useState(!1),l=s.jsx(T,{size:"xs",iconSize:"sm",onClick:()=>{n(e.id)},children:s.jsx(je,{})}),u=s.jsx(G,{"aria-label":"Upload progress",size:"w-24 h-24",value:r,trackWidth:3});let f;if(a==="failed"){const m=i||x("This file could not be uploaded");f=s.jsx(Re,{children:s.jsx(oe,{variant:"danger",label:s.jsx(ze,{value:m}),children:s.jsx($n,{className:"text-danger",size:"md"})})})}else a==="aborted"?f=s.jsx(Re,{children:s.jsx(On,{className:"text-warning",size:"md"})}):a==="completed"?f=s.jsx(Re,{children:s.jsx(Kn,{size:"md",className:"text-positive"})}):f=s.jsx(Re,{onPointerEnter:m=>{m.pointerType==="mouse"&&d(!0)},onPointerLeave:m=>{m.pointerType==="mouse"&&d(!1)},children:o?l:u});return s.jsx(Y,{children:f})}function Re({children:e,...t}){return s.jsx(O.div,{...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:e})}function $i(){const e=w(t=>t.uploadQueueIsOpen);return s.jsx(Y,{children:e&&s.jsxs(O.div,{className:"fixed bottom-16 right-16 z-modal w-375 rounded border bg text-sm shadow-xl",initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},children:[s.jsx(Oi,{}),s.jsx(Ki,{})]},"upload-queue")})}function Oi(){const e=se(a=>a.activeUploadsCount),t=se(a=>a.completedUploadsCount),n=se(a=>a.clearInactive);let r;return e?r=s.jsx(c,{message:"Uploading :count files",values:{count:e}}):t?r=s.jsx(c,{message:"Uploaded :count files",values:{count:t}}):r=s.jsx(c,{message:"No active uploads"}),s.jsxs("div",{className:"flex min-h-[45px] items-center justify-between gap-10 border-b bg-alt px-10 py-4",children:[r,e===0?s.jsx(T,{size:"sm",onClick:()=>{g().setUploadQueueIsOpen(!1),setTimeout(()=>{n()},200)},children:s.jsx(je,{})}):void 0]})}function Ki(){const e=se(a=>a.fileUploads),t=[...e.values()],n=h.useRef(null),r=kr({count:e.size,getScrollElement:()=>n.current,estimateSize:()=>60,overscan:4});return s.jsx("div",{className:"max-h-320 overflow-y-auto",ref:n,children:s.jsx("div",{className:"relative w-full",style:{height:`${r.getTotalSize()}px`},children:r.getVirtualItems().map(a=>{const i=t[a.index];return s.jsx(zi,{style:{height:`${a.size}px`,transform:`translateY(${a.start}px)`},file:i.file},i.file.id)})})})}const Bi=""+new URL("detailed-examination-33c85772.svg",import.meta.url).href;function dn({entryType:e,entryName:t}){const{setRightSidenavStatus:n}=h.useContext(ue);return s.jsxs("div",{className:"mb-38 flex items-center gap-16 text-text-main",children:[s.jsx(Ce,{className:"h-24 w-24",type:e}),s.jsx("div",{className:"mr-auto min-w-0 flex-auto text-ellipsis break-words text-xl font-normal",children:t}),s.jsx(T,{size:"md",className:"flex-shrink-0",onClick:()=>{n("closed")},children:s.jsx(je,{})})]})}function Fs({children:e,margin:t="mb-20"}){return s.jsx("div",{className:E("text-base text-main",t),children:e})}function Ui(e){return Z({queryKey:un(e),queryFn:()=>Wi(e),initialData:e.initialData?{tags:e.initialData}:void 0})}function un(e){const{taggableType:t,taggableId:n,type:r,notType:a}=e,i=["tags","taggable",t,`${n}`];return r!=null&&i.push(r),a!=null&&i.push(a),i}function mn({taggableType:e,taggableIds:t}){return Promise.allSettled(t.map(n=>C.invalidateQueries({queryKey:un({taggableType:e,taggableId:n})})))}async function Wi({taggableType:e,taggableId:t,notType:n,type:r}){return I.get(`taggable/${e}/${t}/list-tags`,{params:{notType:n,type:r}}).then(a=>a.data)}function fn(){return M({mutationFn:e=>Qi(e),onSuccess:(e,t)=>{mn(t)},onError:e=>L(e)})}function Qi(e){return I.post("taggable/detach-tag",e).then(t=>t.data)}function Vi(e){return Z({queryKey:["tags",e],queryFn:({signal:t})=>Hi(e,t),placeholderData:ms})}async function Hi(e,t){return e.query&&await new Promise(n=>setTimeout(n,300)),I.get("tags",{params:{paginate:"simple",...e},signal:e.query?t:void 0}).then(n=>n.data)}function Yi(){return M({mutationFn:e=>Gi(e),onSuccess:async(e,t)=>{mn(t)},onError:e=>L(e)})}function Gi(e){return I.post("taggable/attach-tag",e).then(t=>t.data)}function Zi({attachedTags:e,tagType:t,notTagType:n,taggableType:r,taggableIds:a,userId:i,isLoading:o,onChange:d}){const{trans:l}=W(),[u,f]=h.useState(""),{data:m,isPlaceholderData:p,isLoading:j}=Vi({type:t,notType:n,query:u,userId:i}),b=fn(),v=Yi(),{tags:y,attachedTagIds:S}=h.useMemo(()=>{const P=(m==null?void 0:m.pagination.data)||[],F=e||[],$=F.map(J=>J.id),re=P.filter(J=>!$.includes(J.id));return re.unshift(...F),{tags:re,attachedTagIds:$}},[e,m]);return s.jsx(X,{children:s.jsxs(V,{padding:"p-8",children:[s.jsx("form",{children:s.jsx(He,{placeholder:l({message:"Type tag name..."}),inputBorder:"border-b",inputRadius:"rounded-none",inputRing:"ring-0",inputShadow:"shadow-none",startAdornment:s.jsx(Ye,{}),value:u,onChange:P=>f(P.target.value),endAdornment:p&&s.jsx(G,{isIndeterminate:!0,size:"w-24 h-24"})})}),s.jsxs(ct,{className:"compact-scrollbar h-320 overflow-y-auto stable-scrollbar",children:[y.map(P=>{const F=S.includes(P.id),$=v.isPending||b.isPending||o;return s.jsx(ts,{isDisabled:$,onSelected:()=>{F?b.mutate({tagId:P.id,taggableIds:a,taggableType:r},{onSuccess:()=>d==null?void 0:d(P.id)}):v.mutate({taggableType:r,taggableIds:a,tagName:P.name,userId:i,tagType:t},{onSuccess:()=>d==null?void 0:d(P.id)})},className:E(F&&($?"text-primary-light":"text-primary")),startIcon:s.jsx(qs,{size:"xs"}),endSection:F?s.jsx(et,{size:"sm",className:"block text-primary"}):s.jsx("div",{className:"h-20 w-20"}),children:P.display_name||P.name},P.id)}),!p&&!(m!=null&&m.pagination.data.length)&&u&&s.jsx(ts,{startIcon:s.jsx(qs,{size:"xs"}),onSelected:()=>{v.mutate({taggableType:r,taggableIds:a,tagName:u,userId:i,tagType:t},{onSuccess:P=>{f(""),d==null||d(P.tag.id)}})},children:s.jsx(c,{message:'Create tag ":name"',values:{name:u}})}),m&&!y.length&&!u&&s.jsx("li",{className:"text-center text-muted",children:s.jsx(c,{message:"No tags found"})}),j&&s.jsx("li",{className:"flex justify-center",children:s.jsx(G,{isIndeterminate:!0,size:"w-24 h24"})})]})]})})}function Xi({entry:e}){var i;const{user:t}=_(),n=fn(),{data:r,isFetching:a}=Ui({taggableType:"fileEntry",taggableId:e.id,initialData:(i=e.tags)==null?void 0:i.filter(o=>o.type!=="label"),type:"custom"});return s.jsxs("div",{className:"mt-20 border-t pt-20",children:[s.jsx(Fs,{margin:"mb-10",children:s.jsx(c,{message:"Tags"})}),s.jsx("div",{className:"flex items-center gap-8",children:s.jsx(Bn,{size:"sm",radius:"rounded-button",startButton:s.jsxs(le,{type:"modal",children:[s.jsx(D,{variant:"outline",startIcon:s.jsx(xs,{}),size:"2xs",className:"min-h-26",children:s.jsx(c,{message:"Add tag"})}),s.jsx(Zi,{attachedTags:r==null?void 0:r.tags,isLoading:a,tagType:"custom",taggableType:"fileEntry",taggableIds:[e.id],userId:t==null?void 0:t.id})]}),children:r==null?void 0:r.tags.map(o=>s.jsx(Un,{disabled:n.isPending||a,onRemove:()=>{n.mutate({tagId:o.id,taggableIds:[e.id],taggableType:"fileEntry"})},children:o.display_name||o.name},o.id))})})]})}function Ji({entry:e}){return s.jsxs("div",{children:[s.jsx(dn,{entryType:e.type,entryName:e.name}),e.type==="image"&&s.jsx(gs,{className:"mb-20",file:e}),s.jsxs("div",{children:[s.jsx(Fs,{children:s.jsx(c,{message:"Who has access"})}),s.jsxs("div",{className:"flex items-center gap-14",children:[e.workspace_id?s.jsx("div",{className:"flex h-32 w-32 items-center justify-center rounded-full border",children:s.jsx(vr,{className:"icon-md"})}):null,e.users.map(t=>s.jsx(oe,{label:t.name,children:s.jsx(rs,{src:t.image,size:"md",circle:!0})},t.id))]}),e.permissions["files.update"]&&s.jsx(D,{className:"mt-20 block",variant:"link",color:"primary",onClick:()=>{g().setActiveActionDialog("share",[e])},children:s.jsx(c,{message:"Manage Access"})})]}),s.jsx(eo,{entry:e}),s.jsx(Xi,{entry:e})]})}function eo({entry:e}){const t=Xa(),n=ye(),r=e.users.find(i=>i.owns_entry),a=h.useMemo(()=>xe(e.file_size),[e.file_size]);return s.jsxs("div",{className:"mt-20 border-t pt-20",children:[s.jsx(Fs,{children:s.jsx(c,{message:"Properties"})}),s.jsx(fe,{label:s.jsx(c,{message:"Type"}),value:s.jsx("span",{className:"capitalize",children:s.jsx(c,{message:e.type})})}),s.jsx(fe,{label:s.jsx(c,{message:"Size"}),value:e.file_size?a:"-"}),s.jsx(fe,{label:s.jsx(c,{message:"Location"}),value:s.jsx(D,{variant:"link",startIcon:s.jsx(Oe,{}),onClick:()=>{n(t?Ze(t.hash):R.path)},children:t?t.name:s.jsx(c,{message:"Root"})})}),r&&s.jsx(fe,{label:s.jsx(c,{message:"Owner"}),value:r.name}),s.jsx(fe,{label:s.jsx(c,{message:"Modified"}),value:s.jsx($e,{date:e.updated_at})}),s.jsx(fe,{label:s.jsx(c,{message:"Created"}),value:s.jsx($e,{date:e.updated_at})})]})}function fe({label:e,value:t}){return s.jsxs("div",{className:"mb-14 flex items-center",children:[s.jsx("div",{className:"w-1/3 text-xs text-muted",children:e}),s.jsx("div",{className:"w-2/3 text-sm text-main",children:t})]})}function so({className:e}){const t=Wt();return s.jsx("div",{className:E(e,"h-full overflow-y-auto border-l bg p-18 text-sm text-muted"),children:t?s.jsx(Ji,{entry:t}):s.jsx(to,{})})}function to(){return s.jsxs(h.Fragment,{children:[s.jsx(dn,{entryType:"folder",entryName:s.jsx(c,{message:"All files"})}),s.jsx(Ve,{image:s.jsx(Me,{src:Bi}),description:s.jsx(c,{message:"Select file or folder to see details here"})})]})}function no(e){return M({mutationFn:t=>ro(t),onSuccess:(t,n)=>{B(),N(x(":oldName renamed to :newName",{values:{oldName:n.initialName,newName:t.fileEntry.name}}))},onError:t=>ke(t,e)})}function ro({entryId:e,...t}){return I.put(`file-entries/${e}`,t).then(n=>n.data)}function ao({entries:e}){var d;const{close:t,formId:n}=K(),r=(d=e[0])==null?void 0:d.name,a=Pe({defaultValues:{name:r}}),i=no(a),o=l=>{i.mutate({entryId:e[0].id,name:l.name,initialName:r},{onSuccess:t})};return s.jsxs(X,{children:[s.jsx(te,{children:s.jsx(c,{message:"Rename"})}),s.jsx(V,{children:s.jsx(Ee,{onSubmit:o,form:a,id:n,children:s.jsx(De,{placeholder:"Enter a name...","aria-label":"Entry name",autoFocus:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),s.jsxs(ge,{children:[s.jsx(D,{variant:"flat",onClick:()=>t(),children:s.jsx(c,{message:"Cancel"})}),s.jsx(D,{form:n,type:"submit",variant:"flat",color:"primary",disabled:i.isPending||!a.formState.isDirty,children:s.jsx(c,{message:"Save"})})]})]})}function io({name:e,parentId:t}){return I.post("folders",{name:e,parentId:t===0?null:t}).then(n=>n.data)}function oo(e){return M({mutationFn:({name:t,parentId:n})=>io({name:t,parentId:n}),onSuccess:()=>B(),onError:t=>ke(t,e)})}function hn({parentId:e}){const{close:t,formId:n}=K(),{trans:r}=W(),a=Pe({defaultValues:{name:r({message:"Untitled Folder"})}}),i=oo(a),o=d=>{i.mutate({...d,parentId:e},{onSuccess:l=>{t(l.folder),N(x("Folder created"))}})};return s.jsxs(X,{children:[s.jsx(te,{children:s.jsx(c,{message:"New Folder"})}),s.jsx(V,{children:s.jsx(Ee,{onSubmit:o,form:a,id:n,children:s.jsx(De,{placeholder:r({message:"Enter a name..."}),"aria-label":"Entry name",autoFocus:!0,autoSelectText:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),s.jsxs(ge,{children:[s.jsx(D,{variant:"flat",onClick:()=>t(),children:s.jsx(c,{message:"Cancel"})}),s.jsx(D,{form:n,type:"submit",variant:"flat",color:"primary",disabled:i.isPending,children:s.jsx(c,{message:"Create"})})]})]})}function lo({selectedEntry:e}){const t=Ps().filter(i=>i.type!=="folder"),n=t.findIndex(i=>i.id===(e==null?void 0:e.id)),[r,a]=h.useState(n);return s.jsx(bt,{allowDownload:e.permissions["files.download"],headerActionsLeft:s.jsx(co,{activeIndex:r,entries:t}),activeIndex:r,onActiveIndexChange:a,entries:t})}function co({activeIndex:e,entries:t}){const n=t[e],r=Es([n]);return!n||!r?null:s.jsxs(h.Fragment,{children:[s.jsx(T,{className:"md:hidden",onClick:()=>{r.execute()},children:h.createElement(r.icon)}),s.jsx(D,{className:"max-md:hidden",variant:"text",startIcon:h.createElement(r.icon),onClick:()=>{r.execute()},children:s.jsx(c,{...r.label})})]})}function uo({entryId:e,...t}){return I.post(`file-entries/${e}/share`,t).then(n=>n.data)}function mo(){return M({mutationFn:e=>uo(e),onSuccess:()=>{B()},onError:e=>{var t,n;if(Wn.isAxiosError(e)&&e.response){const r=e.response.data;(t=r.errors)!=null&&t.emails?N.danger((n=r.errors)==null?void 0:n.emails[0]):L(e)}}})}const fo={edit:!0,view:!0,download:!0},he=[{key:"view",value:{view:!0},label:x("Can view")},{key:"download",value:{view:!0,download:!0},label:x("Can Download")},{key:"edit",value:fo,label:x("Can edit")}];function xn({value:e,onChange:t,isDisabled:n}){return s.jsxs(ce,{selectedValue:e.key,selectionMode:"single",onSelectionChange:r=>{r!==e.key&&t(he.find(a=>a.key===r))},children:[s.jsx(D,{variant:"flat",color:"chip",size:"xs",endIcon:s.jsx(as,{}),disabled:n,children:s.jsx(c,{...e.label})}),s.jsx(de,{children:he.map(r=>s.jsx(q,{value:r.key,children:s.jsx(c,{...r.label})},r.key))})]})}function ho(e){const{download:t,edit:n}=e.entry_permissions;return n?he.find(r=>r.key==="edit"):t?he.find(r=>r.key==="download"):he.find(r=>r.key==="view")}function xo(){return M({mutationFn:e=>po(e),onSuccess:()=>{B(),N(x("Updated user permissions"))},onError:e=>L(e,x("Could not update permissions"))})}function po({entryId:e,...t}){return I.put(`file-entries/${e}/change-permissions`,t).then(n=>n.data)}function go({className:e,entry:t}){if(!t)return null;const n=t.users;return s.jsxs("div",{className:E(e,"overflow-hidden"),children:[s.jsx("div",{className:"mb-14 text-sm",children:s.jsx(c,{message:"Who has access"})}),s.jsx(Y,{initial:!1,children:n.map(r=>s.jsx(vo,{user:r,entry:t},r.id))})]})}function vo({user:e,entry:t}){return s.jsxs(O.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"mb-20 flex items-center gap-14 text-sm",children:[s.jsx(Qn,{user:e,circle:!0,size:"w-44 h-44"}),s.jsxs("div",{children:[s.jsx("div",{children:e.name}),s.jsx("div",{className:"text-muted",children:e.email})]}),s.jsx("div",{className:"ml-auto",children:e.owns_entry?s.jsx("span",{className:"text-muted",children:s.jsx(c,{message:"Owner"})}):s.jsx(jo,{user:e,entry:t})})]},e.id)}function jo({user:e,entry:t}){const n=xo(),r=Gt(),[a,i]=h.useState(()=>ho(e));return s.jsxs("div",{className:"flex items-center gap-10",children:[s.jsx(xn,{isDisabled:n.isPending,onChange:o=>{n.mutate({userId:e.id,permissions:o.value,entryId:t.id}),i(o)},value:a}),s.jsx(T,{disabled:r.isPending,onClick:()=>{r.mutate({userId:e.id,entryIds:[t.id]},{onSuccess:()=>{N(x("Member removed"))},onError:o=>L(o,x("Could not remove member"))})},children:s.jsx(je,{})})]})}function yo({className:e,entry:t}){var y;const{trans:n}=W(),{share:r}=Fe(),a=mo(),[i,o]=h.useState([]),[d,l]=h.useState(!1),[u,f]=h.useState(he[0]),m=i.every(S=>!S.invalid),[p,j]=h.useState(""),b=Vn("normalized-models/user",{perPage:7,query:p},{enabled:r==null?void 0:r.suggest_emails}),v=S=>S.description||S.name;return s.jsxs("div",{className:e,children:[s.jsx(Zs,{value:i,onChange:o,isAsync:!0,isLoading:b.fetchStatus==="fetching",inputValue:p,onInputValueChange:j,suggestions:(y=b.data)==null?void 0:y.results,displayWith:v,validateWith:S=>{const P=!Nt(S.description);return{...S,invalid:P,errorMessage:P?n({message:"Not a valid email"}):void 0}},placeholder:n({message:"Enter email addresses"}),label:s.jsx(c,{message:"Invite people"}),children:S=>s.jsx(q,{value:S.id,startIcon:s.jsx(rs,{circle:!0,src:S.image,alt:""}),description:S.description,children:S.name})}),s.jsxs("div",{className:"mt-14 flex items-center justify-between gap-14",children:[s.jsx(xn,{onChange:f,value:u}),i.length?s.jsx(D,{variant:"flat",color:"primary",size:"sm",disabled:d||!m,onClick:()=>{l(!0),a.mutate({emails:i.map(S=>v(S)),permissions:u.value,entryId:t.id},{onSuccess:()=>{o([])},onSettled:()=>{l(!1)}})},children:s.jsx(c,{message:"Share"})}):null]}),s.jsx(go,{className:"mt-30",entry:t})]})}function pn(e){return Z({queryKey:A.fetchEntryShareableLink(e),queryFn:()=>bo(e),enabled:!!e})}function bo(e){return I.get(`file-entries/${e}/shareable-link`,{params:{loader:"shareableLink"}}).then(t=>t.data)}function wo({entryId:e}){return I.delete(`file-entries/${e}/shareable-link`).then(t=>t.data)}function So(){return M({mutationFn:({entryId:e})=>wo({entryId:e}),onSuccess:(e,{entryId:t})=>{C.setQueryData(A.fetchEntryShareableLink(t),{...e,link:null})},onError:e=>L(e,x("Could not delete link"))})}function Io(e=36){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<e;r+=1)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function ko({setActivePanel:e,entry:t,focusInput:n}){var l,u;const r=pn(t.id),a=!!((l=r.data)!=null&&l.link),i=Yt(),o=So(),d=r.isLoading||i.isPending||o.isPending;return s.jsxs("div",{children:[s.jsx("div",{className:"mb-10",children:s.jsx(c,{message:"Share link"})}),s.jsxs("div",{className:"flex items-center justify-between gap-14 px-2 pb-4",children:[s.jsx(fs,{checked:a,disabled:d,onChange:()=>{a?o.mutate({entryId:t.id}):i.mutate({entryId:t.id})},children:a?s.jsx(c,{message:"Shareable link is created"}):s.jsx(c,{message:"Create shareable link"})}),a&&s.jsx(D,{variant:"link",color:"primary",onClick:()=>{e("linkSettings")},children:s.jsx(c,{message:"Link settings"})})]}),s.jsx(Po,{autoFocus:n,link:(u=r.data)==null?void 0:u.link})]})}function Po({link:e,autoFocus:t}){const{base_url:n}=Fe(),{trans:r}=W(),a=Na(),i=(e==null?void 0:e.hash)||(a==null?void 0:a.hash)||Io(),o=`${n}/drive/s/${i}`,[d,l]=Hn(o,{successDuration:1e3});return s.jsx(He,{autoFocus:t,disabled:!e,className:"mt-10",readOnly:!0,value:o,"aria-label":r({message:"Shareable link"}),onFocus:u=>{u.target.select()},endAppend:s.jsx(D,{className:"min-w-100",variant:"flat",color:"primary",onClick:l,children:d?s.jsx(c,{message:"Copied!"}):s.jsx(c,{message:"Copy"})})})}function Eo({entryId:e,...t}){return I.put(`file-entries/${e}/shareable-link`,t).then(n=>n.data)}function Do(e){return M({mutationFn:t=>Eo(t),onSuccess:(t,{entryId:n})=>{C.setQueryData(A.fetchEntryShareableLink(n),t)},onError:t=>ke(t,e)})}function No({className:e,setActivePanel:t,entry:n}){const{formId:r}=K(),{data:a}=pn(n.id),i=a==null?void 0:a.link,o=Pe({defaultValues:{allowDownload:i==null?void 0:i.allow_download,allowEdit:i==null?void 0:i.allow_edit,expiresAt:i==null?void 0:i.expires_at,entryId:n.id}}),d=Do(o);return s.jsxs(h.Fragment,{children:[s.jsx(te,{onDismiss:()=>{t("main")},children:s.jsx(c,{message:"Shareable Link Settings"})}),s.jsx(V,{children:s.jsx(O.div,{className:"min-h-[335px]",animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:s.jsxs(Ee,{id:r,className:e,form:o,onSubmit:l=>{d.mutate(l,{onSuccess:()=>{t("main"),N(x("Link settings saved"))}})},children:[s.jsx(Mo,{showField:!!(i!=null&&i.expires_at)}),s.jsx(Co,{showField:!!(i!=null&&i.password)}),s.jsxs(Ue,{children:[s.jsx(c,{message:"Allow download"}),s.jsx(zs,{name:"allowDownload",children:s.jsx(c,{message:"Users with link can download this item"})})]}),s.jsxs(Ue,{showBorder:!1,children:[s.jsx(c,{message:"Allow import"}),s.jsx(zs,{name:"allowEdit",children:s.jsx(c,{message:"Users with link can import this item into their own drive"})})]})]})},"link-settings-content")}),s.jsxs(ge,{children:[s.jsx(D,{type:"button",onClick:()=>{t("main")},children:s.jsx(c,{message:"Cancel"})}),s.jsx(D,{type:"submit",form:r,variant:"flat",color:"primary",disabled:d.isPending,children:s.jsx(c,{message:"Save"})})]})]})}const Fo=Yn(Gn());function Mo({showField:e}){const{trans:t}=W(),[n,r]=h.useState(e);return s.jsxs(Ue,{children:[s.jsx(c,{message:"Link expiration"}),s.jsxs("div",{children:[s.jsx(fs,{checked:n,onChange:a=>{r(a.target.checked)},children:s.jsx(c,{message:"Link is valid until"})}),n&&s.jsx(Pr,{min:Fo,name:"expiresAt",granularity:"minute",className:"mt-20","aria-label":t({message:"Link expiration date and time"})})]})]})}function Co({showField:e}){const{trans:t}=W(),[n,r]=h.useState(e);return s.jsxs(Ue,{children:[s.jsx(c,{message:"Password protect"}),s.jsxs("div",{children:[s.jsx(fs,{checked:n,onChange:a=>{r(a.target.checked)},children:s.jsx(c,{message:"Users will need to enter password in order to view this link"})}),n&&s.jsx(De,{type:"password",autoFocus:!0,name:"password",className:"mt-20","aria-label":t({message:"Link password"}),description:s.jsx(c,{message:"Password will not be requested when viewing the link as file owner."}),placeholder:t({message:"Enter new password..."})})]})]})}function Ue({children:e,showBorder:t=!0}){const[n,r]=e;return s.jsxs("div",{className:E(t&&"mb-20 border-b pb-20"),children:[s.jsx("div",{className:"mb-8 text-sm font-medium",children:n}),r]})}function Vs({entry:e,focusLinkInput:t}){const{data:{fileEntry:n}}=Z({queryKey:A.fetchFileEntry(e.id),queryFn:()=>I.get(`drive/file-entries/${e.id}/model`).then(i=>i.data),initialData:{fileEntry:e}}),[r,a]=h.useState("main");return s.jsx(X,{size:"lg",children:s.jsx(Y,{initial:!1,mode:"wait",children:r==="linkSettings"?s.jsx(No,{setActivePanel:a,entry:n},"one"):s.jsx(Ao,{setActivePanel:a,entry:n,focusLinkInput:t},"two")})})}function Ao({setActivePanel:e,entry:t,focusLinkInput:n}){return s.jsxs(h.Fragment,{children:[s.jsx(te,{children:s.jsx(c,{message:"Share ‘:name’",values:{name:t.name}})}),s.jsx(V,{className:"relative",children:s.jsxs(O.div,{animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:[s.jsx(yo,{className:"mb-30 border-b pb-30",entry:t}),s.jsx(ko,{setActivePanel:e,entry:t,focusInput:!!n})]},"share-content")})]})}function To({query:e}){const{workspaceId:t}=H(),n=h.useMemo(()=>({section:"search",workspaceId:t,query:e,filters:dt([{key:"type",value:"folder"}])}),[t,e]);return Z({queryKey:A.fetchEntries(n),queryFn:({signal:r})=>Lo(n,r),enabled:!!e,placeholderData:ms})}async function Lo(e,t){return e.query&&await new Promise(n=>setTimeout(n,300)),I.get("drive/file-entries",{params:e,signal:e.query?t:void 0}).then(n=>n.data)}function Ro({onFolderSelected:e}){const{trans:t}=W(),n=t({message:"Search folders"}),[r,a]=h.useState(""),{isFetching:i,data:o}=To({query:r}),d=o==null?void 0:o.data;return s.jsx(Zn,{size:"sm",maxItems:10,placeholder:n,"aria-label":n,className:"pt-20",endAdornmentIcon:s.jsx(Ye,{}),isAsync:!0,isLoading:i,inputValue:r,onInputValueChange:a,blurReferenceOnItemSelection:!0,clearInputOnItemSelection:!0,selectionMode:"none",openMenuOnFocus:!1,children:d==null?void 0:d.map(l=>s.jsx(q,{value:l.id,textLabel:l.name,onSelected:()=>{e(l)},children:l.name},l.id))})}function zo({selectedFolder:e,onFolderSelected:t}){const{data:n}=Ns({hash:e.hash,isEnabled:(e==null?void 0:e.hash)!==R.folder.hash});let r=null;return n!=null&&n.path&&(n.path.length===1?r=R.folder:r=n.path[n.path.length-2]),s.jsxs("div",{className:"flex items-center gap-6 border-b pb-10",children:[s.jsx(T,{className:"flex-shrink-0",variant:"outline",size:"xs",disabled:!r,onClick:()=>{r&&t(r)},children:s.jsx(Mr,{})}),s.jsxs(js,{size:"sm",className:"flex-auto",children:[s.jsxs(Ie,{onSelected:()=>{t(R.folder)},className:"flex items-center gap-8",children:[s.jsx(Oe,{className:"icon-sm"}),s.jsx(c,{message:R.folder.name})]}),n==null?void 0:n.path.map(a=>s.jsxs(Ie,{onSelected:()=>{t(a)},className:"flex items-center gap-8",children:[!a.id&&s.jsx(Oe,{className:"icon-sm"}),a.name]},a.id||"root"))]})]})}const qo=""+new URL("my-files-88476671.svg",import.meta.url).href;function _o({selectedFolder:e,movingSharedFiles:t}){const{workspaceId:n}=H(),r=h.useMemo(()=>{const a=dt([{key:"type",value:"folder"}]);return{section:"folder",folderId:e.hash=="0"&&t?"sharedWithMe":e.hash,workspaceId:n,filters:a}},[n,e.hash,t]);return ys({queryKey:A.fetchEntries(r),queryFn:({pageParam:a=1})=>$o({...r,page:a}),initialPageParam:1,getNextPageParam:a=>{const i=a.current_page;if(at(a))return i+1}})}function $o(e){return I.get("drive/file-entries",{params:e}).then(t=>t.data)}function Oo({onFolderSelected:e,selectedFolder:t,movingSharedFiles:n}){var i,o,d;const r=_o({selectedFolder:t,movingSharedFiles:n});let a;return r.isLoading?a=s.jsx("div",{className:"flex h-full w-full items-center justify-center",children:s.jsx(G,{isIndeterminate:!0,size:"md"})}):((o=(i=r.data)==null?void 0:i.pages[0])==null?void 0:o.data.length)===0?a=s.jsx(Ve,{size:"xs",className:"pb-20 pt-64",image:s.jsx(Me,{src:qo}),title:s.jsx(c,{message:'There are no subfolders in ":folder"',values:{folder:t.name}})}):a=s.jsxs(h.Fragment,{children:[s.jsx(ct,{children:(d=r.data)==null?void 0:d.pages.flatMap(l=>l.data).map(l=>s.jsx(ts,{className:"min-h-48 border-b",onSelected:()=>{e(l)},startIcon:s.jsx(Ce,{type:"folder"}),endIcon:s.jsx(Fr,{size:"md"}),children:l.name},l.id))}),s.jsx(an,{query:r})]}),s.jsx("div",{className:"h-288 overflow-y-auto",children:a})}function Ko({entries:e}){const{user:t}=_(),n=w(o=>o.activePage),[r,a]=h.useState((n==null?void 0:n.folder)||R.folder),i=e.some(o=>{var d;return!((d=o.users.find(l=>l.id===t.id))!=null&&d.owns_entry)});return s.jsxs(X,{size:"lg",children:[s.jsx(te,{children:s.jsx(c,{message:"Move [one ‘:name‘|other :count items]",values:{count:e.length,name:e[0].name}})}),s.jsxs(V,{children:[s.jsx("div",{className:"text-sm",children:s.jsx(c,{message:"Select a destination folder."})}),s.jsx(Ro,{onFolderSelected:a}),s.jsxs("div",{className:"mb-20 mt-40",children:[s.jsx(zo,{selectedFolder:r,onFolderSelected:a}),s.jsx(Oo,{movingSharedFiles:i,selectedFolder:r,onFolderSelected:a})]})]}),s.jsx(Bo,{selectedFolder:r,setSelectedFolder:a,entries:e})]})}function Bo({selectedFolder:e,setSelectedFolder:t,entries:n}){const{close:r}=K(),a=Rt();return s.jsxs(ge,{className:"border-t",startAction:s.jsxs(le,{type:"modal",onClose:i=>{i&&t(i)},children:[s.jsx(D,{startIcon:s.jsx(hs,{}),variant:"text",children:s.jsx(c,{message:"New Folder"})}),s.jsx(hn,{parentId:e.id})]}),children:[s.jsx(D,{className:"max-md:hidden",variant:"flat",onClick:()=>r(),children:s.jsx(c,{message:"Cancel"})}),s.jsx(D,{type:"submit",variant:"flat",color:"primary",disabled:!Ss(n,e)||a.isPending,onClick:()=>{a.mutate({destinationId:e.id,entryIds:n.map(i=>i.id)},{onSuccess:r})},children:s.jsx(c,{message:"Move here"})})]})}function Uo({entries:e}){const t=Te(),{close:n}=K(),r=e.length===1?s.jsx(c,{message:"‘:name‘ will be deleted forever and you won't be able to restore it.",values:{name:e[0].name}}):s.jsx(c,{message:":count items will be deleted forever and you won't be able to restore them.",values:{count:e.length}});return s.jsx(ve,{isDanger:!0,title:s.jsx(c,{message:"Delete forever?"}),body:r,confirm:s.jsx(c,{message:"Delete forever"}),isLoading:t.isPending,onConfirm:()=>{t.mutate({entryIds:e.map(a=>a.id),deleteForever:!0},{onSuccess:()=>{n(),g().selectEntries([])}})}})}function Wo({entries:e}){const t=Zt(),{close:n}=K();return s.jsx(ve,{title:s.jsx(c,{message:"This folder is in your trash"}),body:s.jsx(c,{message:"To view this folder, restore it from the trash."}),confirm:s.jsx(c,{message:"Restore"}),isLoading:t.isPending,onConfirm:()=>{t.mutate({entryIds:e.map(r=>r.id)},{onSuccess:()=>{n(),g().selectEntries([])}})}})}function Qo(){const e=w(n=>n.activeActionDialog),t=Vo(e);return s.jsx(le,{type:"modal",isOpen:!!t,onClose:()=>{g().setActiveActionDialog(null)},children:t})}function Vo(e){var t;switch(e==null?void 0:e.name){case"rename":return s.jsx(ao,{entries:e.entries});case"newFolder":return s.jsx(hn,{parentId:(t=e.entries[0])==null?void 0:t.id});case"preview":return s.jsx(lo,{selectedEntry:e.entries[0]});case"share":return s.jsx(Vs,{entry:e.entries[0]});case"getLink":return s.jsx(Vs,{entry:e.entries[0],focusLinkInput:!0});case"moveTo":return s.jsx(Ko,{entries:e.entries});case"confirmAndDeleteForever":return s.jsx(Uo,{entries:e.entries});case"trashFolderBlock":return s.jsx(Wo,{entries:e.entries});default:return null}}function Ho(){const{trans:e}=W(),t=ye(),n=w(o=>o.activePage),[r]=cs(),[a,i]=h.useState(r.get("query")||"");return s.jsx("form",{className:"max-w-620 flex-auto",onSubmit:o=>{o.preventDefault(),t({pathname:ae.path,search:`?query=${a}`},{replace:!0})},children:s.jsx(He,{size:"sm",background:"bg",value:a,onChange:o=>i(o.target.value),onFocus:()=>{n!==ae&&t(ae.path)},startAdornment:s.jsx(T,{type:"submit",children:s.jsx(Ye,{})}),className:"max-w-620 flex-auto",placeholder:e({message:"Search"}),"aria-label":e({message:"Search files and folders"})})})}function Yo(e){const t=h.useRef(e),n=h.useId();h.useEffect(()=>($s.set(n,t.current),()=>{$s.delete(n)}),[n])}function Go(){const e=h.useRef(null),[t,n]=h.useState(),[r,a]=h.useState({});Yo({type:"fileEntry",onDragStart:(o,d)=>{const l=d;l&&(a({entries:l.getData(),e:o,draggingTreeItem:Aa(l.id)}),n({start:o}))},onDragMove:o=>{a(d=>({...d,e:o})),n(d=>({...d,end:o}))},onDragEnd:(o,d,l)=>{a({status:l})}});let i=null;return r.entries&&r.e&&(i=s.jsx("div",{ref:e,style:r.e?{transform:`translate(${r.e.x}px, ${r.e.y}px)`,width:`${r.e.rect.width}px`}:void 0,className:"pointer-events-none fixed left-0 top-0 isolate",children:r.entries.map((o,d)=>s.jsx(Zo,{index:d,entry:o,points:t,state:r},o.id))})),s.jsx(Y,{custom:r.status,children:i})}const Zo=h.memo(({entry:e,points:t,index:n,state:r})=>{var f,m,p,j;const a=w(b=>b.viewMode),i=r.draggingTreeItem?Is(e):e.id,o=jt.get(i);if(!(o!=null&&o.rect)||!(t!=null&&t.start))return null;const d=o.rect,l=((f=r.entries)==null?void 0:f.length)||0,u=b=>{var v,y,S;return b==="dropSuccess"?{x:0,y:0,opacity:0,transition:{duration:.1,delay:0}}:{x:d.left-(((v=t.end)==null?void 0:v.x)||0),y:d.top-(((y=t.end)==null?void 0:y.y)||0),width:`${(S=r.e)==null?void 0:S.rect.width}px`}};return s.jsxs(O.div,{transition:{delay:.01*n,bounce:0,duration:.2},initial:{x:d.left-t.start.x,y:d.top-t.start.y,width:`${(m=r.e)==null?void 0:m.rect.width}px`},animate:{x:0,y:0,width:a==="list"?288:void 0},exit:u,style:{width:a==="grid"?`${(p=r.e)==null?void 0:p.rect.width}px`:void 0,height:`${(j=r.e)==null?void 0:j.rect.height}px`},className:E("absolute max-h-48 whitespace-nowrap rounded border border-primary-light bg-paper",n<2&&"shadow",n===0&&"left-0 top-0 z-10",n>0&&"left-6 top-6"),children:[l>1&&n===0&&s.jsx(Xo,{count:l}),s.jsxs("div",{className:"flex h-full items-center justify-center gap-10 overflow-hidden bg-primary-light/20 px-16 text-sm",children:[s.jsx(Ce,{type:e.type}),s.jsx("div",{className:"flex-auto overflow-hidden text-ellipsis",children:e.name})]})]},e.id)}),Xo=h.memo(({count:e})=>s.jsx(O.div,{initial:{opacity:0},animate:{opacity:1,transition:{delay:.1}},exit:{opacity:0},transition:{duration:.1},className:"absolute -right-6 -top-6 z-10 z-30 flex h-20 w-20 items-center justify-center rounded-full bg-danger text-sm font-bold text-white shadow-lg",children:e},"entryCount"));function gn({children:e,className:t}){return s.jsx("div",{className:E(t,"dashboard-grid-header"),children:e})}function Jo(){const{isMobileMode:e}=h.useContext(ue),t=w(n=>n.activePage);return s.jsxs(gn,{className:"flex h-60 items-center gap-20 border-b px-8 py-4 md:px-26",children:[e?s.jsx(ln,{isDisabled:t==null?void 0:t.disableSort}):s.jsx(rn,{}),s.jsxs("div",{className:"ml-auto flex-shrink-0 text-muted",children:[s.jsx(el,{}),s.jsx(sl,{})]})]})}function el(){const e=w(n=>n.viewMode),t=e==="grid"?s.jsx(c,{message:"List view"}):s.jsx(c,{message:"Grid view"});return s.jsx(oe,{label:t,children:s.jsx(T,{size:"md",onClick:()=>{g().setViewMode(g().viewMode==="list"?"grid":"list")},children:e==="list"?s.jsx(jr,{}):s.jsx(yr,{})})})}function sl(){const{rightSidenavStatus:e,setRightSidenavStatus:t}=h.useContext(ue),n=e?s.jsx(c,{message:"Hide details"}):s.jsx(c,{message:"Show details"});return s.jsx(oe,{label:n,children:s.jsx(T,{size:"md",color:e==="open"?"primary":null,onClick:()=>{t(e==="open"?"closed":"open")},children:s.jsx(Er,{})})})}const tl={modifyUploadedFile:e=>{const t=rt();return e.fingerprint=`${e.fingerprint}-w-${t}`,e}};function El(){const{pathname:e}=ut(),{hash:t,userId:n}=Qe(),{workspaceId:r}=H(),a=w(o=>o.activePage);h.useEffect(()=>{g().setActivePage(Pa.find(o=>o.path===e)||Ct(t))},[e,t]);const i=h.useMemo(()=>({workspaceId:r,userId:n?parseInt(n):void 0}),[r,n]);return h.useEffect(()=>()=>{g().reset()},[]),s.jsxs(h.Fragment,{children:[(a==null?void 0:a.label)&&s.jsx(Xn,{children:s.jsx(c,{message:typeof a.label=="string"?a.label:a.label.message})}),s.jsxs(mt,{options:tl,children:[s.jsx(wt.Provider,{value:i,children:s.jsxs(St,{name:"drive",onDragOver:o=>{o.preventDefault(),o.stopPropagation(),o.dataTransfer.dropEffect="none"},onDrop:o=>{o.preventDefault()},children:[s.jsx(nl,{}),s.jsx(Os,{position:"left",size:"md",children:s.jsx(Ua,{})}),s.jsx(Jo,{}),s.jsx(It,{children:s.jsx(Ri,{})}),s.jsx($i,{}),s.jsx(Qo,{}),s.jsx(Os,{position:"right",size:"lg",children:s.jsx(so,{})})]})}),s.jsx(Go,{})]})]})}function nl(){const{isMobileMode:e}=h.useContext(ue),t=w(i=>i.activePage),n=e?null:s.jsx(Ho,{}),r=s.jsx(T,{elementType:is,to:ae.path,children:s.jsx(Ye,{})}),a=s.jsxs(h.Fragment,{children:[t!==ae&&r,s.jsx(Kt,{isCompact:!0})]});return s.jsxs(h.Fragment,{children:[s.jsx(kt,{rightChildren:e&&a,menuPosition:"drive-navbar",children:n}),e&&s.jsx(rl,{})]})}function rl(){const e=w(t=>t.selectedEntries.size);return e?s.jsxs("div",{className:"fixed right-0 top-0 z-10 flex h-54 w-full items-center justify-center gap-10 rounded bg-primary px-6 text-on-primary shadow-xl",children:[s.jsx(T,{onClick:()=>{g().selectEntries([])},children:s.jsx(je,{})}),s.jsx(c,{message:":count selected",values:{count:e}}),s.jsx(cn,{className:"ml-auto"})]}):null}const U=tt()(nt(e=>({password:null,viewMode:qe("drive.viewMode"),activeSort:{orderBy:"updated_at",orderDir:"desc"},setPassword:t=>{e(n=>{n.password=t})},isPasswordProtected:!1,setIsPasswordProtected:t=>{e(n=>{n.isPasswordProtected=t})},setViewMode:t=>{e(n=>{n.viewMode=t,es("drive.viewMode",t)})},setActiveSort:t=>{e(n=>{n.activeSort=t})}})));function ie(){return U.getState()}function ne(){var d,l;const{hash:e}=Qe(),{orderBy:t,orderDir:n}=U(u=>u.activeSort),r=`${t}:${n}`,a=U(u=>u.isPasswordProtected),i=U(u=>u.password),o=ys({queryKey:A.fetchShareableLink({hash:e,sort:r}),queryFn:async({pageParam:u=1})=>{const f=await al({hash:e,page:u,order:r,password:i});return f.passwordInvalid&&ie().setIsPasswordProtected(!0),f},initialData:()=>{var f,m;const u=(f=ls().loaders)==null?void 0:f.shareableLinkPage;if(u&&((m=u.link)==null?void 0:m.hash)===e)return u.passwordInvalid&&ie().setIsPasswordProtected(!0),{pageParams:[void 0,1],pages:[u]}},initialPageParam:1,getNextPageParam:u=>{if(!u.folderChildren)return;const f=u.folderChildren.current_page,m=u.folderChildren.last_page;if(!(f>=m))return f+1},enabled:!!e&&!a||i!=null,placeholderData:ms});return{...o,link:(d=o.data)==null?void 0:d.pages[0].link,entries:(l=o.data)==null?void 0:l.pages.flatMap(u=>{var f;return(f=u.folderChildren)==null?void 0:f.data})}}function al({hash:e,page:t=1,order:n,password:r}){return I.get(`shareable-links/${e}`,{params:{loader:"shareableLinkPage",page:t,order:n,password:r}}).then(a=>a.data)}function il({password:e,linkHash:t}){return I.post(`shareable-links/${t}/check-password`,{password:e}).then(n=>n.data)}function ol(){return M({mutationFn:e=>il(e),onSuccess:(e,t)=>{e.matches&&ie().setPassword(t.password)},onError:e=>L(e,x("Could not create link"))})}function ll({linkId:e,password:t}){return I.post(`shareable-links/${e}/import`,{password:t}).then(n=>n.data)}function cl(){const e=U(t=>t.password);return M({mutationFn:t=>ll({...t,password:e}),onSuccess:async()=>{await C.invalidateQueries({queryKey:A.fetchShareableLink()}),N(x("Item imported into your drive"))},onError:t=>L(t,x("Could not create link"))})}function vn(){var o;const{link:e}=ne(),{user:t,isLoggedIn:n}=_(),{downloadUrl:r}=yt(e==null?void 0:e.entry),a=cl(),i=(o=e==null?void 0:e.entry)==null?void 0:o.users.find(d=>d.id===(t==null?void 0:t.id));return e!=null&&e.entry?s.jsxs("div",{children:[e.allow_download&&s.jsx(dl,{downloadUrl:r}),!i&&n&&e.allow_edit&&s.jsxs(ce,{onItemSelected:d=>{d==="import"?a.mutate({linkId:e.id}):d==="download"&&r&&Be(r)},children:[s.jsx(T,{className:"ml-6",disabled:a.isPending,children:s.jsx(st,{})}),s.jsxs(de,{children:[s.jsx(q,{value:"download",startIcon:s.jsx(Ke,{}),children:s.jsx(c,{message:"Download"})}),s.jsx(q,{value:"import",startIcon:s.jsx(br,{}),children:s.jsx(c,{message:"Save a copy to your own drive"})})]})]})]}):null}function dl({downloadUrl:e}){return s.jsxs(h.Fragment,{children:[s.jsx(oe,{label:s.jsx(c,{message:"Download"}),children:s.jsx(T,{className:"md:hidden",onClick:()=>{e&&Be(e)},children:s.jsx(Ke,{})})}),s.jsx(D,{className:"max-md:hidden",size:"sm",variant:"flat",color:"chip",startIcon:s.jsx(Ke,{}),onClick:()=>{e&&Be(e)},children:s.jsx(c,{message:"Download"})})]})}function jn(){const{link:e}=ne(),t=ft();return s.jsx(Jn,{size:"md",color:"bg",className:"flex-shrink-0",rightChildren:(e==null?void 0:e.entry)&&s.jsx(vn,{}),menuPosition:"shareable-link-page",hideLogo:t,children:(e==null?void 0:e.entry)&&e.entry.type!=="folder"&&s.jsxs("div",{className:"fex-auto flex min-w-0 items-center gap-10",children:[s.jsx(Ce,{className:"flex-shrink-0",type:e.entry.type}),s.jsx("div",{className:"flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:e.entry.name})]})})}function ul(){const{trans:e}=W(),{hash:t}=Qe(),n=e({message:"Password"}),[r,a]=h.useState(""),i=ol(),o=t?t.split(":")[0]:null,d=i.data&&!i.data.matches;return s.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[s.jsx(jn,{}),s.jsx("div",{className:"mx-auto my-80 px-10 md:px-20",children:s.jsxs("div",{className:"flex max-w-[560px] flex-col items-center gap-40 rounded border bg p-24 md:flex-row md:gap-14",children:[s.jsx("div",{className:"h-132 w-[165px]",children:s.jsx(Me,{src:er})}),s.jsxs("form",{onSubmit:l=>{l.preventDefault(),i.mutate({linkHash:o,password:r})},children:[s.jsx("span",{className:"text-sm",children:s.jsx(c,{message:"The link you are trying to access is password protected."})}),s.jsx(He,{autoFocus:!0,placeholder:n,"aria-label":n,className:"mb-20 mt-10",type:"password",value:r,required:!0,errorMessage:d&&s.jsx(c,{message:"Password is not valid"}),onChange:l=>{a(l.target.value)}}),s.jsx("div",{className:"text-right",children:s.jsx(D,{variant:"flat",color:"primary",type:"submit",className:"w-full md:w-auto",disabled:i.isPending,children:s.jsx(c,{message:"Enter"})})})]})]})})]})}function ml({entries:e,onEntrySelected:t}){return s.jsx("div",{className:"file-grid",children:e.map((n,r)=>s.jsx(nn,{tabIndex:-1,className:"hover:shadow-md cursor-pointer bg",entry:n,onContextMenu:a=>{a.preventDefault()},onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&t(n,r)},onClick:()=>{t(n,r)}},n.id))})}const fl=Ds.filter(e=>e.key!=="updated_at");function hl({entries:e,onEntrySelected:t}){const n=U(a=>a.activeSort),r=ft();return s.jsx(lt,{columns:r?fl:Ds,data:e,sortDescriptor:n,onSortChange:a=>{ie().setActiveSort(a)},onAction:(a,i)=>{t(a,i)},enableSelection:!1})}function xl(e,t){var r;let n=e.hash;return t&&((r=e.entry)==null?void 0:r.hash)!==t&&(n=`${n}:${t}`),n}function yn(){const{link:e}=ne(),t=sr();return n=>{e&&t(`/drive/s/${xl(e,n)}`)}}function pl({className:e}){const{pathname:t}=ut(),n=yn(),[r,a]=h.useState(),i=U(v=>v.viewMode),o=h.useRef(null),{link:d,entries:l,isFetchingNextPage:u,hasNextPage:f,fetchNextPage:m,isPlaceholderData:p}=ne();if(h.useEffect(()=>{a(void 0)},[t]),h.useEffect(()=>{const v=o.current;if(!v)return;const y=new IntersectionObserver(([S])=>{S.isIntersecting&&f&&m()});return y.observe(v),()=>{y.unobserve(v)}},[f,m]),!d||p)return s.jsx("div",{className:E("flex justify-center",e),children:s.jsx(G,{isIndeterminate:!0})});const j=(v,y)=>{v.type==="folder"?n(v.hash):a(y)},b=l||[];return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:E("file-grid-container flex-auto overflow-auto px-14 pb-14 md:px-24 md:pb-24",e),children:[s.jsx(ht,{slot:"file-preview",className:"mb-40"}),i==="grid"?s.jsx(ml,{entries:b,onEntrySelected:j}):s.jsx(hl,{entries:b,onEntrySelected:j}),s.jsx("span",{ref:o,"aria-hidden":!0}),s.jsx(Y,{children:u&&s.jsx(O.div,{className:"mt-24 flex w-full justify-center",...us,children:s.jsx(G,{isIndeterminate:!0,"aria-label":"loading"})})})]}),s.jsx(le,{type:"modal",isOpen:r!=null,onClose:()=>a(void 0),children:s.jsx(bt,{entries:b,defaultActiveIndex:r,allowDownload:d.allow_download})})]})}function gl({className:e,folder:t,link:n}){const r=yn(),a=U(d=>d.password),i=Ns({hash:t==null?void 0:t.hash,params:{shareable_link:n.id,password:a}});let o;if(i.isLoading)o=null;else{const d=[];i.data&&i.data.path.forEach(l=>{d.push({folder:l,label:s.jsx(s.Fragment,{children:l.name})})}),o=s.jsx(js,{size:"lg",isNavigation:!0,children:d.map(l=>s.jsx(Ie,{onSelected:()=>{r(l.folder.hash)},children:l.label},l.folder.hash))})}return s.jsx("div",{className:E("h-36 flex-shrink-0",e),children:o})}function vl(){const e=U(a=>a.activeSort),{link:t,isFetching:n}=ne(),r=t&&t.entry;return s.jsxs("div",{className:"flex flex-col justify-between gap-14 p-14 md:h-90 md:flex-row md:items-center md:p-24",children:[r&&s.jsx(gl,{link:t,folder:t.entry,className:"flex-auto"}),r&&s.jsxs("div",{className:"flex items-center justify-between text-muted md:justify-start",children:[s.jsx(on,{isDisabled:n,descriptor:e,onChange:a=>{ie().setActiveSort(a)}}),s.jsx("div",{className:"ml-10 md:border-l md:pl-10",children:s.jsx(T,{onClick:()=>{ie().setViewMode(ie().viewMode==="grid"?"list":"grid")},children:s.jsx(wr,{})})})]})]})}function jl(){const{entries:e,isFetched:t}=ne(),n=t&&!(e!=null&&e.length);return s.jsxs(St,{name:"folder-preview",children:[s.jsx(kt,{hideToggleButton:!0,rightChildren:s.jsx(vn,{}),color:"bg"}),s.jsx(gn,{children:s.jsx(vl,{})}),s.jsx(mt,{children:s.jsx(It,{children:n?s.jsx(yl,{}):s.jsx(pl,{})})})]})}function yl({className:e}){return s.jsx(Ve,{className:E(e,"mt-80"),image:s.jsx(Me,{src:Mt}),title:s.jsx(c,{message:"Folder is empty"}),description:s.jsx(c,{message:"No files have been uploaded to this folder yet"})})}function bl(){const{link:e}=ne();return e!=null&&e.entry?s.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[s.jsx(jn,{}),s.jsx(ht,{slot:"file-preview",className:"mx-auto mt-24"}),s.jsx(Dr,{entries:[e.entry],showHeader:!1,allowDownload:e.allow_download})]}):null}function Dl(){var o;const{status:e,link:t}=ne(),{trans:n}=W(),r=U(d=>d.isPasswordProtected),a=U(d=>d.password);let i;if(e==="pending")i=s.jsx("div",{className:"flex h-screen flex-auto items-center justify-center",children:s.jsx(G,{"aria-label":n({message:"Loading link"}),isIndeterminate:!0})});else{if(!t&&!r)return s.jsx(tr,{});r&&!a?i=s.jsx(ul,{}):((o=t==null?void 0:t.entry)==null?void 0:o.type)==="folder"?i=s.jsx(jl,{}):i=s.jsx(bl,{})}return s.jsx(nr,{children:s.jsx(wt.Provider,{value:{shareable_link:t==null?void 0:t.id,password:a},children:i})})}export{El as DriveLayout,Dl as ShareableLinkPage};
//# sourceMappingURL=drive-routes.lazy-63d76678.js.map
